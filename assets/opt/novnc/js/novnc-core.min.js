var Util={},addFunc=function(t,e,i){t.prototype[e]||Object.defineProperty(t.prototype,e,{enumerable:!1,value:i})};addFunc(Array,"push8",function(t){"use strict";this.push(255&t)}),addFunc(Array,"push16",function(t){"use strict";this.push(t>>8&255,255&t)}),addFunc(Array,"push32",function(t){"use strict";this.push(t>>24&255,t>>16&255,t>>8&255,255&t)}),addFunc(Array,"map",function(t){"use strict";var e=this.length;if("function"!=typeof t)throw new TypeError;for(var i=new Array(e),s=arguments[1],r=0;r<e;r++)r in this&&(i[r]=t.call(s,this[r],r,this));return i}),addFunc(Array,"indexOf",function(t){"use strict";var e=this.length>>>0,i=Number(arguments[1])||0;for((i=i<0?Math.ceil(i):Math.floor(i))<0&&(i+=e);i<e;i++)if(i in this&&this[i]===t)return i;return-1}),Object.keys||(Object.keys=function(){"use strict";var r=Object.prototype.hasOwnProperty,n=!{toString:null}.propertyIsEnumerable("toString"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=o.length;return function(t){if("object"!=typeof t&&("function"!=typeof t||null===t))throw new TypeError("Object.keys called on non-object");var e,i,s=[];for(e in t)r.call(t,e)&&s.push(e);if(n)for(i=0;i<a;i++)r.call(t,o[i])&&s.push(o[i]);return s}}()),addFunc(Function,"bind",function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function e(){}function i(){return r.apply(this instanceof e&&t?this:t,s.concat(Array.prototype.slice.call(arguments)))}var s=Array.prototype.slice.call(arguments,1),r=this;return e.prototype=this.prototype,i.prototype=new e,i}),window.requestAnimFrame=function(){"use strict";return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),Util._log_level="warn",Util.init_logging=function(t){"use strict";switch(void 0===t?t=Util._log_level:Util._log_level=t,void 0===window.console&&(void 0!==window.opera?window.console={log:window.opera.postError,warn:window.opera.postError,error:window.opera.postError}:window.console={log:function(t){},warn:function(t){},error:function(t){}}),Util.Debug=Util.Info=Util.Warn=Util.Error=function(t){},t){case"debug":Util.Debug=function(t){console.log(t)};case"info":Util.Info=function(t){console.info(t)};case"warn":Util.Warn=function(t){console.warn(t)};case"error":Util.Error=function(t){console.error(t)};case"none":break;default:throw new Error("invalid logging type '"+t+"'")}},Util.get_logging=function(){return Util._log_level},Util.init_logging(),Util.make_property=function(t,s,e,i){"use strict";function r(i){return i?function(t,e){void 0!==e?this["_"+s][e]=i(t):this["_"+s]=i(t)}:function(t,e){void 0!==e?this["_"+s][e]=t:this["_"+s]=t}}var n,o="arr"===i?function(t){return void 0!==t?this["_"+s][t]:this["_"+s]}:function(){return this["_"+s]};if("bool"===i)n=r(function(t){return!(!t||t in{0:1,no:1,false:1})});else if("int"===i)n=r(function(t){return parseInt(t,10)});else if("float"===i)n=r(parseFloat);else if("str"===i)n=r(String);else if("func"===i)n=r(function(t){return t||function(){}});else{if("arr"!==i&&"dom"!==i&&"raw"!=i)throw new Error("Unknown property type "+i);n=r()}void 0===t["get_"+s]&&(t["get_"+s]=o),void 0===t["set_"+s]&&("rw"===e?t["set_"+s]=n:"wo"===e&&(t["set_"+s]=function(t,e){if(void 0!==this["_"+s])throw new Error(s+" can only be set once");n.call(this,t,e)})),t["_raw_set_"+s]=function(t,e){n.call(this,t,e)}},Util.make_properties=function(t,e){"use strict";for(var i=0;i<e.length;i++)Util.make_property(t.prototype,e[i][0],e[i][1],e[i][2])},Util.set_defaults=function(t,e,i){for(var s=Object.keys(i),r=Object.keys(e),n={},o=0;o<s.length;o++)n[s[o]]=1;for(o=0;o<r.length;o++)n[r[o]]=1;var a=Object.keys(n);for(o=0;o<a.length;o++){var h=t["_raw_set_"+a[o]];h?a[o]in e?h.call(t,e[a[o]]):h.call(t,i[a[o]]):Util.Warn("Invalid property "+a[o])}},Util.decodeUTF8=function(t){"use strict";return decodeURIComponent(escape(t))},Util.get_include_uri=function(){return"undefined"!=typeof INCLUDE_URI?INCLUDE_URI:"include/"},Util._loading_scripts=[],Util._pending_scripts=[],Util.load_scripts=function(t){"use strict";for(var e,i=document.getElementsByTagName("head")[0],s=Util._loading_scripts,r=Util._pending_scripts,n=function(t){for(;0<s.length&&("loaded"===s[0].readyState||"complete"===s[0].readyState);){var e=s.shift();i.appendChild(e)}(!this.readyState||Util.Engine.presto&&"loaded"===this.readyState||"complete"===this.readyState)&&0<=r.indexOf(this)&&(this.onload=this.onreadystatechange=null,r.splice(r.indexOf(this),1),0===r.length&&window.onscriptsload&&window.onscriptsload())},o=0;o<t.length;o++)(e=document.createElement("script")).type="text/javascript",e.src=Util.get_include_uri()+t[o],e.onload=e.onreadystatechange=n,Util.Engine.trident?s.push(e):(e.async=!1,i.appendChild(e)),r.push(e)},Util.getPosition=function(t){"use strict";t=t.getBoundingClientRect();return{x:t.left+window.pageXOffset,y:t.top+window.pageYOffset,width:t.width,height:t.height}},Util.getEventPosition=function(t,e,i){"use strict";var s,t=t||window.event;(t=t.changedTouches?t.changedTouches[0]:t.touches?t.touches[0]:t).pageX||t.pageY?(s=t.pageX,r=t.pageY):(t.clientX||t.clientY)&&(s=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),void 0===i&&(i=1);var e=s-(s=Util.getPosition(e)).x,r=r-s.y;return{x:Math.max(Math.min(e,s.width-1),0)/i,y:Math.max(Math.min(r,s.height-1),0)/i,realx:e/i,realy:r/i}},Util.addEvent=function(t,e,i){"use strict";if(t.attachEvent)return t.attachEvent("on"+e,i);if(t.addEventListener)return t.addEventListener(e,i,!1),!0;throw new Error("Handler could not be attached")},Util.removeEvent=function(t,e,i){"use strict";if(t.detachEvent)return t.detachEvent("on"+e,i);if(t.removeEventListener)return t.removeEventListener(e,i,!1),!0;throw new Error("Handler could not be removed")},Util.stopEvent=function(t){"use strict";t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault?t.preventDefault():t.returnValue=!1},Util._cursor_uris_supported=null,Util.browserSupportsCursorURIs=function(){if(null===Util._cursor_uris_supported)try{var t=document.createElement("canvas");t.style.cursor='url("data:image/x-icon;base64,AAACAAEACAgAAAIAAgA4AQAAFgAAACgAAAAIAAAAEAAAAAEAIAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAA==") 2 2, default',t.style.cursor?(Util.Info("Data URI scheme cursor supported"),Util._cursor_uris_supported=!0):(Util.Warn("Data URI scheme cursor not supported"),Util._cursor_uris_supported=!1)}catch(t){Util.Error("Data URI scheme cursor test exception: "+t),Util._cursor_uris_supported=!1}return Util._cursor_uris_supported},Util.Features={xpath:!!document.evaluate,air:!!window.runtime,query:!!document.querySelector},function(){"use strict";Util.Engine={presto:!!window.opera,trident:!!window.ActiveXObject&&(window.XMLHttpRequest?document.querySelectorAll?6:5:4),webkit:function(){try{return!navigator.taintEnabled&&(Util.Features.xpath?Util.Features.query?525:420:419)}catch(t){return!1}}(),gecko:!(!document.getBoxObjectFor&&null==window.mozInnerScreenX)&&(document.getElementsByClassName?19:18)},Util.Engine.webkit&&(Util.Engine.webkit=function(t){t=(navigator.userAgent.match(/WebKit\/([0-9\.]*) /)||["",t])[1];return parseFloat(t,10)}(Util.Engine.webkit))}(),Util.Flash=function(){"use strict";var e;try{e=navigator.plugins["Shockwave Flash"].description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(t){e="0 r0"}}return e=e.match(/\d+/g),{version:parseInt(e[0]||"0."+e[1],10)||0,build:parseInt(e[2],10)||0}}();var $D,WebUtil={};window.$D||(window.$D=function(t){return document.getElementById?document.getElementById(t):document.all?document.all[t]:document.layers?document.layers[t]:void 0}),WebUtil.init_logging=function(t){"use strict";void 0!==t?Util._log_level=t:(t=document.location.href.match(/logging=([A-Za-z0-9\._\-]*)/),Util._log_level=(t||["",Util._log_level])[1]),Util.init_logging()},WebUtil.dirObj=function(t,e,i){"use strict";e=e||2,i=i||"";var s,r,n="";for(s in t)1<e&&"object"==typeof t[s]?n+=WebUtil.dirObj(t[s],e-1,i+"."+s):(r="",n+=i+"."+s+": "+(r=30<(r=void 0===t[s]?"undefined":t[s].toString().replace("\n"," ")).length?r.substr(0,30)+"...":r)+"\n");return n},WebUtil.getQueryVar=function(t,e){"use strict";t=new RegExp(".*[?&]"+t+"=([^&#]*)"),t=document.location.href.match(t);return void 0===e&&(e=null),t?decodeURIComponent(t[1]):e},WebUtil.getHashVar=function(t,e){"use strict";t=new RegExp(".*[&#]"+t+"=([^&]*)"),t=document.location.hash.match(t);return void 0===e&&(e=null),t?decodeURIComponent(t[1]):e},WebUtil.getConfigVar=function(t,e){"use strict";var i=WebUtil.getHashVar(t);return i=null===i?WebUtil.getQueryVar(t,e):i},WebUtil.createCookie=function(t,e,i){"use strict";var i=i?((s=new Date).setTime(s.getTime()+24*i*60*60*1e3),"; expires="+s.toGMTString()):"",s="https:"===document.location.protocol?"; secure":"";document.cookie=t+"="+e+i+"; path=/"+s},WebUtil.readCookie=function(t,e){"use strict";for(var i=t+"=",s=document.cookie.split(";"),r=0;r<s.length;r+=1){for(var n=s[r];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(i))return n.substring(i.length,n.length)}return void 0!==e?e:null},WebUtil.eraseCookie=function(t){"use strict";WebUtil.createCookie(t,"",-1)},WebUtil.initSettings=function(e){"use strict";var i=Array.prototype.slice.call(arguments,1);window.chrome&&window.chrome.storage?window.chrome.storage.sync.get(function(t){WebUtil.settings=t,console.log(WebUtil.settings),e&&e.apply(this,i)}):e&&e.apply(this,i)},WebUtil.writeSetting=function(t,e){"use strict";window.chrome&&window.chrome.storage?WebUtil.settings[t]!==e&&(WebUtil.settings[t]=e,window.chrome.storage.sync.set(WebUtil.settings)):localStorage.setItem(t,e)},WebUtil.readSetting=function(t,e){"use strict";t=window.chrome&&window.chrome.storage?WebUtil.settings[t]:localStorage.getItem(t);return null===(t=void 0===t?null:t)?e:t},WebUtil.eraseSetting=function(t){"use strict";window.chrome&&window.chrome.storage?(window.chrome.storage.sync.remove(t),delete WebUtil.settings[t]):localStorage.removeItem(t)},WebUtil.getStylesheets=function(){"use strict";for(var t=document.getElementsByTagName("link"),e=[],i=0;i<t.length;i+=1)t[i].title&&-1<t[i].rel.toUpperCase().indexOf("STYLESHEET")&&e.push(t[i]);return e},WebUtil.selectStylesheet=function(t){"use strict";void 0===t&&(t="default");for(var e=WebUtil.getStylesheets(),i=0;i<e.length;i+=1){var s=e[i];s.title===t?(Util.Debug("Using stylesheet "+t),s.disabled=!1):s.disabled=!0}return t},WebUtil.injectParamIfMissing=function(t,e,i){t="/"+t;var s=document.createElement("a");s.href=t;var r=encodeURIComponent(e)+"=",e=s.search?s.search.slice(1).split("&"):[];return e.some(function(t){return t.startsWith(r)})||(e.push(r+encodeURIComponent(i)),s.search="?"+e.join("&")),"/"==s.pathname.charAt(0)?s.pathname.slice(1)+s.search+s.hash:s.pathname+s.search+s.hash};var Base64={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),base64Pad:"=",encode:function(t){"use strict";for(var e="",i=Base64.toBase64Table,s=t.length,r=s%3,n=0;n<s-2;n+=3)e+=i[t[n]>>2],e+=i[((3&t[n])<<4)+(t[n+1]>>4)],e+=i[((15&t[n+1])<<2)+(t[n+2]>>6)],e+=i[63&t[n+2]];var o=0;return 2==r?(e+=i[t[o=s-r]>>2],e+=i[((3&t[o])<<4)+(t[o+1]>>4)],e+=i[(15&t[o+1])<<2],e+=i[64]):1==r&&(e+=i[t[o=s-r]>>2],e+=i[(3&t[o])<<4],e+=i[64],e+=i[64]),e},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(t,e){"use strict";e=void 0!==e?e:0;for(var i=Base64.toBinaryTable,s=Base64.base64Pad,r=0,n=0,o=t.indexOf("=")-e,o=3*((o=o<0?t.length-e:o)>>2)+Math.floor(o%4/1.5),a=new Array(o),h=0,_=e;_<t.length;_++){var c=i[127&t.charCodeAt(_)],l=t.charAt(_)===s;-1!==c?(n=n<<6|c,8<=(r+=6)&&(r-=8,l||(a[h++]=n>>r&255),n&=(1<<r)-1)):console.error("Illegal character code "+t.charCodeAt(_)+" at position "+_)}if(r)throw err=new Error("Corrupted base64 string"),err.name="Base64-Error",err;return a}};function Websock(){"use strict";this._websocket=null,this._rQi=0,this._rQlen=0,this._rQbufferSize=4194304,this._rQmax=this._rQbufferSize/8,this._rQ=null,this._sQbufferSize=10240,this._sQlen=0,this._sQ=null,this._mode="binary",this.maxBufferedAmount=200,this._eventHandlers={message:function(){},open:function(){},close:function(){},error:function(){}}}function DES(t){"use strict";var e,i,s,r,n,h,_,c,l,u,f,d,p,g=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],b=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],y=[];function o(t){var e,i=0,s=t.slice(),r=0,n=s[i++]<<24|s[i++]<<16|s[i++]<<8|s[i++],o=s[i++]<<24|s[i++]<<16|s[i++]<<8|s[i++],a=252645135&(n>>>4^o);for(o^=a,o^=a=65535&((n^=a<<4)>>>16^o),o^=(a=858993459&(o>>>2^(n^=a<<16)))<<2,o=(o^=(a=16711935&(o>>>8^(n^=a)))<<8)<<1|o>>>31&1,o^=a=2863311530&((n^=a)^o),n=(n^=a)<<1|n>>>31&1,i=0;i<8;++i)a=o<<28|o>>>4,a^=y[r++],e=d[63&a],e|=u[a>>>8&63],e|=c[a>>>16&63],e|=h[a>>>24&63],a=o^y[r++],e|=p[63&a],e|=f[a>>>8&63],e|=l[a>>>16&63],a=(n^=e|=_[a>>>24&63])<<28|n>>>4,a^=y[r++],e=d[63&a],e|=u[a>>>8&63],e|=c[a>>>16&63],e|=h[a>>>24&63],a=n^y[r++],e|=p[63&a],e|=f[a>>>8&63],e|=l[a>>>16&63],o^=e|=_[a>>>24&63];for(o=o<<31|o>>>1,o^=a=2863311530&(n^o),o^=a=16711935&((n=(n^=a)<<31|n>>>1)>>>8^o),o^=a=858993459&((n^=a<<8)>>>2^o),o^=(a=65535&(o>>>16^(n^=a<<2)))<<16,a=[o^=(a=252645135&(o>>>4^(n^=a)))<<4,n^=a],i=0;i<8;i++)s[i]=(a[i>>>2]>>>8*(3-i%4))%256,s[i]<0&&(s[i]+=256);return s}return h=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,1<<24|0,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,1<<24|4,1<<24|4,65540,0,1028,66564,1<<24|0,65536,16843780,4,16842752,16843776,1<<24|0,1<<24|0,1024,16842756,65536,66560,1<<24|4,1024,4,16778244,66564,16843780,65540,16842752,16778244,1<<24|4,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],_=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,1<<31|32,-2146402272,-2146402304,1<<31|0,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,1<<31|0,32768,1081376,-2146435072,1048608,1<<31|32,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,1<<31|0,32800,-2146402304,1048576,1<<31|32,1048608,-2147450848,1<<31|32,1048608,1081344,0,-2147450880,32800,1<<31|0,-2146435040,-2146402272,1081344],c=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,1<<27|8,1<<27|8,131072,134349320,131080,134348800,520,1<<27|0,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,1<<27|0,134349312,1<<27|0,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,1<<27|8,512,0,134348808,134218248,131072,1<<27|0,134349320,8,131592,131584,1<<27|8,134348800,134218248,520,134348800,131592,8,134348808,131584],l=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],u=[256,34078976,34078720,1107296512,524288,256,1<<30|0,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1<<30|0,1<<25|0,1074266112,1074266112,0,1<<30|256,1107820800,1107820800,33554688,1107820544,1<<30|256,0,1107296256,34078976,1<<25|0,1107296256,524544,524288,1107296512,256,1<<25|0,1<<30|0,34078720,1107296512,1074266368,33554688,1<<30|0,1107820544,34078976,1074266368,256,1<<25|0,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1<<30|256,524288,0,1074266112,34078976,1<<30|256],f=[1<<29|16,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,1<<29|16,4194320,536887296,1<<29|0,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,1<<29|0,536887296,16,541065232,4210688,541081616,4194304,16400,1<<29|16,4194304,536887296,1<<29|0,16400,1<<29|16,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,1<<29|0,4194320,536887312],d=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,1<<26|2,2,1<<26|0,69206018,2050,67110912,2099202,2097154,67110912,1<<26|2,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,1<<26|0,2099200,1<<26|0,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,1<<26|0,67110912,2097152,69208064,2050,2099202,69208064,2050,1<<26|2,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,1<<26|2,67110912,2048,2097154],p=[(i=1<<28)|(n=4160),r=4096,0|(e=1<<18),(s=e|i)|n,0|i,i|n,64,0|i,64|e,0|s,s|n,e|r,s|r,e|n,4096,64,0|s,64|i,i|r,4160,e|r,64|e,64|s,s|r,4160,0,0,64|s,64|i,i|r,e|n,0|e,e|n,0|e,s|r,4096,64,64|s,4096,e|n,i|r,64,64|i,0|s,64|s,0|i,0|e,i|n,0,s|n,64|e,64|i,0|s,i|r,i|n,0,s|n,e|r,e|r,4160,4160,64|e,0|i,s|r],function(t){for(var e,i,s,r,n,o,a,h,_=[],c=[],l=[],u=0,f=56;u<56;++u,f-=8)_[u]=0!=(t[(f+=f<-5?65:f<-3?31:f<-1?63:27===f?35:0)>>>3]&1<<(i=7&f))?1:0;for(e=0;e<16;++e){for(l[i=e<<1]=l[s=i+1]=0,r=28;r<59;r+=28)for(u=r-28;u<r;++u)c[u]=(f=u+b[e])<r?_[f]:_[f-28];for(u=0;u<24;++u)0!==c[g[u]]&&(l[i]|=1<<23-u),0!==c[g[u+24]]&&(l[s]|=1<<23-u)}for(h=a=e=0;e<16;++e)n=l[a++],o=l[a++],y[h]=(16515072&n)<<6,y[h]|=(4032&n)<<10,y[h]|=(16515072&o)>>>10,y[h]|=(4032&o)>>>6,y[++h]=(258048&n)<<12,y[h]|=(63&n)<<16,y[h]|=(258048&o)>>>4,y[h]|=63&o,++h}(t),{encrypt:function(t){return o(t.slice(0,8)).concat(o(t.slice(8,16)))}}}window.WebSocket&&!window.WEB_SOCKET_FORCE_FLASH?Websock_native=!0:window.MozWebSocket&&!window.WEB_SOCKET_FORCE_FLASH?(Websock_native=!0,window.WebSocket=window.MozWebSocket):Websock_native=!1,function(){"use strict";var i=41943040,s=function(){try{var t=new Uint8Array([1,2,3]);return String.fromCharCode.apply(null,t),function(t){return String.fromCharCode.apply(null,t)}}catch(t){return function(t){return String.fromCharCode.apply(null,Array.prototype.slice.call(t))}}}();Websock.prototype={get_sQ:function(){return this._sQ},get_rQ:function(){return this._rQ},get_rQi:function(){return this._rQi},set_rQi:function(t){this._rQi=t},rQlen:function(){return this._rQlen-this._rQi},rQpeek8:function(){return this._rQ[this._rQi]},rQshift8:function(){return this._rQ[this._rQi++]},rQskip8:function(){this._rQi++},rQskipBytes:function(t){this._rQi+=t},rQshift16:function(){return(this._rQ[this._rQi++]<<8)+this._rQ[this._rQi++]},rQshift32:function(){return(this._rQ[this._rQi++]<<24)+(this._rQ[this._rQi++]<<16)+(this._rQ[this._rQi++]<<8)+this._rQ[this._rQi++]},rQshiftStr:function(t){void 0===t&&(t=this.rQlen());var e=new Uint8Array(this._rQ.buffer,this._rQi,t);return this._rQi+=t,s(e)},rQshiftBytes:function(t){return void 0===t&&(t=this.rQlen()),this._rQi+=t,new Uint8Array(this._rQ.buffer,this._rQi-t,t)},rQshiftTo:function(t,e){void 0===e&&(e=this.rQlen()),t.set(new Uint8Array(this._rQ.buffer,this._rQi,e)),this._rQi+=e},rQwhole:function(){return new Uint8Array(this._rQ.buffer,0,this._rQlen)},rQslice:function(t,e){return e?new Uint8Array(this._rQ.buffer,this._rQi+t,e-t):new Uint8Array(this._rQ.buffer,this._rQi+t,this._rQlen-this._rQi-t)},rQwait:function(t,e,i){if(this._rQlen-this._rQi<e){if(i){if(this._rQi<i)throw new Error("rQwait cannot backup "+i+" bytes");this._rQi-=i}return!0}return!1},flush:function(){return 0!==this._websocket.bufferedAmount&&Util.Debug("bufferedAmount: "+this._websocket.bufferedAmount),this._websocket.bufferedAmount<this.maxBufferedAmount?(0<this._sQlen&&this._websocket.readyState===WebSocket.OPEN&&(this._websocket.send(this._encode_message()),this._sQlen=0),!0):(Util.Info("Delaying send, bufferedAmount: "+this._websocket.bufferedAmount),!1)},send:function(t){return this._sQ.set(t,this._sQlen),this._sQlen+=t.length,this.flush()},send_string:function(t){this.send(t.split("").map(function(t){return t.charCodeAt(0)}))},off:function(t){this._eventHandlers[t]=function(){}},on:function(t,e){this._eventHandlers[t]=e},_allocate_buffers:function(){this._rQ=new Uint8Array(this._rQbufferSize),this._sQ=new Uint8Array(this._sQbufferSize)},init:function(t,e){this._allocate_buffers(),this._rQi=0,this._websocket=null;var i=!1;"Uint8Array"in window&&"set"in Uint8Array.prototype&&(i=!0);var s=!1;try{i&&("binaryType"in WebSocket.prototype||new WebSocket(e+"://.").binaryType)&&(Util.Info("Detected binaryType support in WebSockets"),s=!0)}catch(t){}if(void 0===t&&(t="binary"),Array.isArray(t)&&-1<t.indexOf("binary")&&(t="binary"),!s)throw new Error("noVNC no longer supports base64 WebSockets.  Please use a browser which supports binary WebSockets.");if("binary"!=t)throw new Error("noVNC no longer supports base64 WebSockets.  Please use the binary subprotocol instead.");return t},open:function(t,e){var i=t.match(/^([a-z]+):\/\//)[1];e=this.init(e,i),this._websocket=new WebSocket(t,e),0<=e.indexOf("binary")&&(this._websocket.binaryType="arraybuffer"),this._websocket.onmessage=this._recv_message.bind(this),this._websocket.onopen=function(){if(Util.Debug(">> WebSock.onopen"),this._websocket.protocol?(this._mode=this._websocket.protocol,Util.Info("Server choose sub-protocol: "+this._websocket.protocol)):(this._mode="binary",Util.Error("Server select no sub-protocol!: "+this._websocket.protocol)),"binary"!=this._mode)throw new Error("noVNC no longer supports base64 WebSockets.  Please use the binary subprotocol instead.");this._eventHandlers.open(),Util.Debug("<< WebSock.onopen")}.bind(this),this._websocket.onclose=function(t){Util.Debug(">> WebSock.onclose"),this._eventHandlers.close(t),Util.Debug("<< WebSock.onclose")}.bind(this),this._websocket.onerror=function(t){Util.Debug(">> WebSock.onerror: "+t),this._eventHandlers.error(t),Util.Debug("<< WebSock.onerror: "+t)}.bind(this)},close:function(){this._websocket&&(this._websocket.readyState!==WebSocket.OPEN&&this._websocket.readyState!==WebSocket.CONNECTING||(Util.Info("Closing WebSocket connection"),this._websocket.close()),this._websocket.onmessage=function(t){})},_encode_message:function(){return new Uint8Array(this._sQ.buffer,0,this._sQlen)},_expand_compact_rQ:function(t){var e=t||this._rQlen-this._rQi>this._rQbufferSize/2;if(e&&(t?this._rQbufferSize=8*(this._rQlen-this._rQi+t):this._rQbufferSize*=2),this._rQbufferSize>i&&(this._rQbufferSize=i,this._rQbufferSize-this._rQlen-this._rQi<t))throw new Exception("Receive Queue buffer exceeded "+i+" bytes, and the new message could not fit");e?(e=this._rQ.buffer,this._rQmax=this._rQbufferSize/8,this._rQ=new Uint8Array(this._rQbufferSize),this._rQ.set(new Uint8Array(e,this._rQi))):this._rQ.set(new Uint8Array(this._rQ.buffer,this._rQi)),this._rQlen=this._rQlen-this._rQi,this._rQi=0},_decode_message:function(t){t=new Uint8Array(t);t.length>this._rQbufferSize-this._rQlen&&this._expand_compact_rQ(t.length),this._rQ.set(t,this._rQlen),this._rQlen+=t.length},_recv_message:function(e){try{this._decode_message(e.data),0<this.rQlen()?(this._eventHandlers.message(),this._rQlen==this._rQi?(this._rQlen=0,this._rQi=0):this._rQlen>this._rQmax&&this._expand_compact_rQ()):Util.Debug("Ignoring empty message")}catch(t){e="";t.name&&(e+="\n    name: "+t.name+"\n",e+="    message: "+t.message+"\n"),void 0!==t.description&&(e+="    description: "+t.description+"\n"),void 0!==t.stack&&(e+=t.stack),0<e.length?Util.Error("recv_message, caught exception: "+e):Util.Error("recv_message, caught exception: "+t),void 0!==t.name?this._eventHandlers.error(t.name+": "+t.message):this._eventHandlers.error(t)}}}}();var Keyboard,Mouse,Display,RFB,keysyms=function(){"use strict";var e={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,160:160,161:161,162:162,163:163,164:164,165:165,166:166,167:167,168:168,169:169,170:170,171:171,172:172,173:173,174:174,175:175,176:176,177:177,178:178,179:179,180:180,181:181,182:182,183:183,184:184,185:185,186:186,187:187,188:188,189:189,190:190,191:191,192:192,193:193,194:194,195:195,196:196,197:197,198:198,199:199,200:200,201:201,202:202,203:203,204:204,205:205,206:206,207:207,208:208,209:209,210:210,211:211,212:212,213:213,214:214,215:215,216:216,217:217,218:218,219:219,220:220,221:221,222:222,223:223,224:224,225:225,226:226,227:227,228:228,229:229,230:230,231:231,232:232,233:233,234:234,235:235,236:236,237:237,238:238,239:239,240:240,241:241,242:242,243:243,244:244,245:245,246:246,247:247,248:248,249:249,250:250,251:251,252:252,253:253,254:254,255:255,256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,300:16777516,301:16777517,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,372:16777588,373:16777589,374:16777590,375:16777591,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,399:16777615,402:2294,415:16777631,416:16777632,417:16777633,431:16777647,432:16777648,437:16777653,438:16777654,439:16777655,466:16777681,486:16777702,487:16777703,601:16777817,629:16777845,658:16777874,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1170:16778386,1171:16778387,1174:16778390,1175:16778391,1178:16778394,1179:16778395,1180:16778396,1181:16778397,1186:16778402,1187:16778403,1198:16778414,1199:16778415,1200:16778416,1201:16778417,1202:16778418,1203:16778419,1206:16778422,1207:16778423,1208:16778424,1209:16778425,1210:16778426,1211:16778427,1240:16778456,1241:16778457,1250:16778466,1251:16778467,1256:16778472,1257:16778473,1262:16778478,1263:16778479,1329:16778545,1330:16778546,1331:16778547,1332:16778548,1333:16778549,1334:16778550,1335:16778551,1336:16778552,1337:16778553,1338:16778554,1339:16778555,1340:16778556,1341:16778557,1342:16778558,1343:16778559,1344:16778560,1345:16778561,1346:16778562,1347:16778563,1348:16778564,1349:16778565,1350:16778566,1351:16778567,1352:16778568,1353:16778569,1354:16778570,1355:16778571,1356:16778572,1357:16778573,1358:16778574,1359:16778575,1360:16778576,1361:16778577,1362:16778578,1363:16778579,1364:16778580,1365:16778581,1366:16778582,1370:16778586,1371:16778587,1372:16778588,1373:16778589,1374:16778590,1377:16778593,1378:16778594,1379:16778595,1380:16778596,1381:16778597,1382:16778598,1383:16778599,1384:16778600,1385:16778601,1386:16778602,1387:16778603,1388:16778604,1389:16778605,1390:16778606,1391:16778607,1392:16778608,1393:16778609,1394:16778610,1395:16778611,1396:16778612,1397:16778613,1398:16778614,1399:16778615,1400:16778616,1401:16778617,1402:16778618,1403:16778619,1404:16778620,1405:16778621,1406:16778622,1407:16778623,1408:16778624,1409:16778625,1410:16778626,1411:16778627,1412:16778628,1413:16778629,1414:16778630,1415:16778631,1417:16778633,1418:16778634,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,1619:16778835,1620:16778836,1621:16778837,1632:16778848,1633:16778849,1634:16778850,1635:16778851,1636:16778852,1637:16778853,1638:16778854,1639:16778855,1640:16778856,1641:16778857,1642:16778858,1648:16778864,1657:16778873,1662:16778878,1670:16778886,1672:16778888,1681:16778897,1688:16778904,1700:16778916,1705:16778921,1711:16778927,1722:16778938,1726:16778942,1729:16778945,1740:16778956,1746:16778962,1748:16778964,1776:16778992,1777:16778993,1778:16778994,1779:16778995,1780:16778996,1781:16778997,1782:16778998,1783:16778999,1784:16779e3,1785:16779001,3458:16780674,3459:16780675,3461:16780677,3462:16780678,3463:16780679,3464:16780680,3465:16780681,3466:16780682,3467:16780683,3468:16780684,3469:16780685,3470:16780686,3471:16780687,3472:16780688,3473:16780689,3474:16780690,3475:16780691,3476:16780692,3477:16780693,3478:16780694,3482:16780698,3483:16780699,3484:16780700,3485:16780701,3486:16780702,3487:16780703,3488:16780704,3489:16780705,3490:16780706,3491:16780707,3492:16780708,3493:16780709,3494:16780710,3495:16780711,3496:16780712,3497:16780713,3498:16780714,3499:16780715,3500:16780716,3501:16780717,3502:16780718,3503:16780719,3504:16780720,3505:16780721,3507:16780723,3508:16780724,3509:16780725,3510:16780726,3511:16780727,3512:16780728,3513:16780729,3514:16780730,3515:16780731,3517:16780733,3520:16780736,3521:16780737,3522:16780738,3523:16780739,3524:16780740,3525:16780741,3526:16780742,3530:16780746,3535:16780751,3536:16780752,3537:16780753,3538:16780754,3539:16780755,3540:16780756,3542:16780758,3544:16780760,3545:16780761,3546:16780762,3547:16780763,3548:16780764,3549:16780765,3550:16780766,3551:16780767,3570:16780786,3571:16780787,3572:16780788,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,4304:16781520,4305:16781521,4306:16781522,4307:16781523,4308:16781524,4309:16781525,4310:16781526,4311:16781527,4312:16781528,4313:16781529,4314:16781530,4315:16781531,4316:16781532,4317:16781533,4318:16781534,4319:16781535,4320:16781536,4321:16781537,4322:16781538,4323:16781539,4324:16781540,4325:16781541,4326:16781542,4327:16781543,4328:16781544,4329:16781545,4330:16781546,4331:16781547,4332:16781548,4333:16781549,4334:16781550,4335:16781551,4336:16781552,4337:16781553,4338:16781554,4339:16781555,4340:16781556,4341:16781557,4342:16781558,7682:16784898,7683:16784899,7690:16784906,7691:16784907,7710:16784926,7711:16784927,7734:16784950,7735:16784951,7744:16784960,7745:16784961,7766:16784982,7767:16784983,7776:16784992,7777:16784993,7786:16785002,7787:16785003,7808:16785024,7809:16785025,7810:16785026,7811:16785027,7812:16785028,7813:16785029,7818:16785034,7819:16785035,7840:16785056,7841:16785057,7842:16785058,7843:16785059,7844:16785060,7845:16785061,7846:16785062,7847:16785063,7848:16785064,7849:16785065,7850:16785066,7851:16785067,7852:16785068,7853:16785069,7854:16785070,7855:16785071,7856:16785072,7857:16785073,7858:16785074,7859:16785075,7860:16785076,7861:16785077,7862:16785078,7863:16785079,7864:16785080,7865:16785081,7866:16785082,7867:16785083,7868:16785084,7869:16785085,7870:16785086,7871:16785087,7872:16785088,7873:16785089,7874:16785090,7875:16785091,7876:16785092,7877:16785093,7878:16785094,7879:16785095,7880:16785096,7881:16785097,7882:16785098,7883:16785099,7884:16785100,7885:16785101,7886:16785102,7887:16785103,7888:16785104,7889:16785105,7890:16785106,7891:16785107,7892:16785108,7893:16785109,7894:16785110,7895:16785111,7896:16785112,7897:16785113,7898:16785114,7899:16785115,7900:16785116,7901:16785117,7902:16785118,7903:16785119,7904:16785120,7905:16785121,7906:16785122,7907:16785123,7908:16785124,7909:16785125,7910:16785126,7911:16785127,7912:16785128,7913:16785129,7914:16785130,7915:16785131,7916:16785132,7917:16785133,7918:16785134,7919:16785135,7920:16785136,7921:16785137,7922:16785138,7923:16785139,7924:16785140,7925:16785141,7926:16785142,7927:16785143,7928:16785144,7929:16785145,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8304:16785520,8308:16785524,8309:16785525,8310:16785526,8311:16785527,8312:16785528,8313:16785529,8320:16785536,8321:16785537,8322:16785538,8323:16785539,8324:16785540,8325:16785541,8326:16785542,8327:16785543,8328:16785544,8329:16785545,8352:16785568,8353:16785569,8354:16785570,8355:16785571,8356:16785572,8357:16785573,8358:16785574,8359:16785575,8360:16785576,8361:3839,8362:16785578,8363:16785579,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8709:16785925,8711:2245,8712:16785928,8713:16785929,8715:16785931,8728:3018,8730:2262,8731:16785947,8732:16785948,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8748:16785964,8749:16785965,8756:2240,8757:16785973,8764:2248,8771:2249,8773:16785992,8775:16785991,8800:2237,8801:2255,8802:16786018,8803:16786019,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,10240:16787456,10241:16787457,10242:16787458,10243:16787459,10244:16787460,10245:16787461,10246:16787462,10247:16787463,10248:16787464,10249:16787465,10250:16787466,10251:16787467,10252:16787468,10253:16787469,10254:16787470,10255:16787471,10256:16787472,10257:16787473,10258:16787474,10259:16787475,10260:16787476,10261:16787477,10262:16787478,10263:16787479,10264:16787480,10265:16787481,10266:16787482,10267:16787483,10268:16787484,10269:16787485,10270:16787486,10271:16787487,10272:16787488,10273:16787489,10274:16787490,10275:16787491,10276:16787492,10277:16787493,10278:16787494,10279:16787495,10280:16787496,10281:16787497,10282:16787498,10283:16787499,10284:16787500,10285:16787501,10286:16787502,10287:16787503,10288:16787504,10289:16787505,10290:16787506,10291:16787507,10292:16787508,10293:16787509,10294:16787510,10295:16787511,10296:16787512,10297:16787513,10298:16787514,10299:16787515,10300:16787516,10301:16787517,10302:16787518,10303:16787519,10304:16787520,10305:16787521,10306:16787522,10307:16787523,10308:16787524,10309:16787525,10310:16787526,10311:16787527,10312:16787528,10313:16787529,10314:16787530,10315:16787531,10316:16787532,10317:16787533,10318:16787534,10319:16787535,10320:16787536,10321:16787537,10322:16787538,10323:16787539,10324:16787540,10325:16787541,10326:16787542,10327:16787543,10328:16787544,10329:16787545,10330:16787546,10331:16787547,10332:16787548,10333:16787549,10334:16787550,10335:16787551,10336:16787552,10337:16787553,10338:16787554,10339:16787555,10340:16787556,10341:16787557,10342:16787558,10343:16787559,10344:16787560,10345:16787561,10346:16787562,10347:16787563,10348:16787564,10349:16787565,10350:16787566,10351:16787567,10352:16787568,10353:16787569,10354:16787570,10355:16787571,10356:16787572,10357:16787573,10358:16787574,10359:16787575,10360:16787576,10361:16787577,10362:16787578,10363:16787579,10364:16787580,10365:16787581,10366:16787582,10367:16787583,10368:16787584,10369:16787585,10370:16787586,10371:16787587,10372:16787588,10373:16787589,10374:16787590,10375:16787591,10376:16787592,10377:16787593,10378:16787594,10379:16787595,10380:16787596,10381:16787597,10382:16787598,10383:16787599,10384:16787600,10385:16787601,10386:16787602,10387:16787603,10388:16787604,10389:16787605,10390:16787606,10391:16787607,10392:16787608,10393:16787609,10394:16787610,10395:16787611,10396:16787612,10397:16787613,10398:16787614,10399:16787615,10400:16787616,10401:16787617,10402:16787618,10403:16787619,10404:16787620,10405:16787621,10406:16787622,10407:16787623,10408:16787624,10409:16787625,10410:16787626,10411:16787627,10412:16787628,10413:16787629,10414:16787630,10415:16787631,10416:16787632,10417:16787633,10418:16787634,10419:16787635,10420:16787636,10421:16787637,10422:16787638,10423:16787639,10424:16787640,10425:16787641,10426:16787642,10427:16787643,10428:16787644,10429:16787645,10430:16787646,10431:16787647,10432:16787648,10433:16787649,10434:16787650,10435:16787651,10436:16787652,10437:16787653,10438:16787654,10439:16787655,10440:16787656,10441:16787657,10442:16787658,10443:16787659,10444:16787660,10445:16787661,10446:16787662,10447:16787663,10448:16787664,10449:16787665,10450:16787666,10451:16787667,10452:16787668,10453:16787669,10454:16787670,10455:16787671,10456:16787672,10457:16787673,10458:16787674,10459:16787675,10460:16787676,10461:16787677,10462:16787678,10463:16787679,10464:16787680,10465:16787681,10466:16787682,10467:16787683,10468:16787684,10469:16787685,10470:16787686,10471:16787687,10472:16787688,10473:16787689,10474:16787690,10475:16787691,10476:16787692,10477:16787693,10478:16787694,10479:16787695,10480:16787696,10481:16787697,10482:16787698,10483:16787699,10484:16787700,10485:16787701,10486:16787702,10487:16787703,10488:16787704,10489:16787705,10490:16787706,10491:16787707,10492:16787708,10493:16787709,10494:16787710,10495:16787711,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200};function i(t){return t?{keysym:t,keyname:t}:void 0}return{fromUnicode:function(t){return i(e[t])},lookup:i}}(),kbdUtil=function(){"use strict";function i(t){var e={536:350,537:351,538:354,539:355}[t];return e||t}function n(t,e){var i,s={};for(i in e)parseInt(i)!==XK_Shift_L&&(s[i]=e[i]);var r,n=0;for(r in e)s[r]&&++n;return o(t,s)?n>t.length:0<n}function o(t,e){if(0===t.length)return!1;for(var i=0;i<t.length;++i)if(!e[t[i]])return!1;return!0}function a(t){if(t.char&&1===t.char.length?e=t.char.charCodeAt():t.charCode?e=t.charCode:t.keyCode&&"keypress"===t.type&&(e=t.keyCode),e){var e=keysyms.fromUnicode(i(e));if(e)return e}return t.keyCode?keysyms.lookup(s(t.keyCode,t.shiftKey)):t.which?keysyms.lookup(s(t.which,t.shiftKey)):null}function s(t,e){if("number"!=typeof t)return null;if(48<=t&&t<=57)return t;if(65<=t&&t<=90)return e?t:t+32;if(96<=t&&t<=105)return XK_KP_0+(t-96);switch(t){case 32:return XK_space;case 106:return XK_KP_Multiply;case 107:return XK_KP_Add;case 108:return XK_KP_Separator;case 109:return XK_KP_Subtract;case 110:return XK_KP_Decimal;case 111:return XK_KP_Divide;case 187:return XK_plus;case 188:return XK_comma;case 189:return XK_minus;case 190:return XK_period}return r({keyCode:t})}function r(t){if(!t.keyCode)return null;t=t.keyCode;if(112<=t&&t<=135)return XK_F1+t-112;switch(t){case 8:return XK_BackSpace;case 13:return XK_Return;case 9:return XK_Tab;case 27:return XK_Escape;case 46:return XK_Delete;case 36:return XK_Home;case 35:return XK_End;case 33:return XK_Page_Up;case 34:return XK_Page_Down;case 45:return XK_Insert;case 37:return XK_Left;case 38:return XK_Up;case 39:return XK_Right;case 40:return XK_Down;case 16:return XK_Shift_L;case 17:return XK_Control_L;case 18:return XK_Alt_L;case 224:return XK_Meta_L;case 225:return XK_ISO_Level3_Shift;case 91:return XK_Super_L;case 92:return XK_Super_R;case 93:return XK_Menu;default:return null}}return{hasShortcutModifier:n,hasCharModifier:o,ModifierSync:function(t){t=t||(navigator&&/mac/i.exec(navigator.platform)?[XK_Alt_L]:navigator&&/win/i.exec(navigator.platform)?[XK_Alt_L,XK_Control_L]:navigator&&/linux/i.exec(navigator.platform)?[XK_ISO_Level3_Shift]:[]);var r={};function s(t,e){var i=[];function s(t){return{keysym:keysyms.lookup(t),type:r[t]?"keydown":"keyup"}}return void 0!==t.ctrlKey&&t.ctrlKey!==r[XK_Control_L]&&e!==XK_Control_L&&(r[XK_Control_L]=t.ctrlKey,i.push(s(XK_Control_L))),void 0!==t.altKey&&t.altKey!==r[XK_Alt_L]&&e!==XK_Alt_L&&(r[XK_Alt_L]=t.altKey,i.push(s(XK_Alt_L))),void 0!==t.altGraphKey&&t.altGraphKey!==r[XK_ISO_Level3_Shift]&&e!==XK_ISO_Level3_Shift&&(r[XK_ISO_Level3_Shift]=t.altGraphKey,i.push(s(XK_ISO_Level3_Shift))),void 0!==t.shiftKey&&t.shiftKey!==r[XK_Shift_L]&&e!==XK_Shift_L&&(r[XK_Shift_L]=t.shiftKey,i.push(s(XK_Shift_L))),void 0!==t.metaKey&&t.metaKey!==r[XK_Meta_L]&&e!==XK_Meta_L&&(r[XK_Meta_L]=t.metaKey,i.push(s(XK_Meta_L))),i}function e(t,e){var i=a(t),i=i?i.keysym:null;return null!==i&&void 0!==r[i]&&(r[i]=e),s(t,i)}return r[XK_Control_L]=!1,r[XK_Alt_L]=!1,r[XK_ISO_Level3_Shift]=!1,r[XK_Shift_L]=!1,r[XK_Meta_L]=!1,{keydown:function(t){return e(t,!0)},keyup:function(t){return e(t,!1)},syncAny:function(t){return s(t)},hasShortcutModifier:function(){return n(t,r)},activeCharModifier:function(){return o(t,r)?t:null}}},getKey:function(t){return"keyCode"in t&&"key"in t?t.key+":"+t.keyCode:"keyCode"in t?t.keyCode:t.key},getKeysym:a,keysymFromKeyCode:s,nonCharacterKey:r,substituteCodepoint:i}}();function KeyEventDecoder(h,_){"use strict";function e(t){for(var e=0;e<t.length;++e)_(t[e])}function i(t,e){var i={type:e},s=kbdUtil.getKey(t);s&&(i.keyId=s);var r=kbdUtil.getKeysym(t),s=h.hasShortcutModifier()||!!h.activeCharModifier();r&&("keydown"!==e||kbdUtil.nonCharacterKey(t)||s)&&(i.keysym=r);var s=!(16===t.keyCode||"Shift"===t.key)&&("keydown"!==e||h.hasShortcutModifier()||!!kbdUtil.nonCharacterKey(t)),t="keydown"===e&&h.activeCharModifier()&&!kbdUtil.nonCharacterKey(t),n=h.activeCharModifier();if(n&&r){for(var o=!1,a=0;a<n.length;++a)n[a]===r.keysym&&(o=!0);"keypress"!==e||o||(i.escape=h.activeCharModifier())}return t&&_({type:"stall"}),_(i),s}return{keydown:function(t){return e(h.keydown(t)),i(t,"keydown")},keypress:function(t){return i(t,"keypress")},keyup:function(t){return e(h.keyup(t)),i(t,"keyup")},syncModifiers:function(t){e(h.syncAny(t))},releaseAll:function(){_({type:"releaseall"})}}}function VerifyCharModifier(s){"use strict";var r=[],n=null;return function(t){r.push(t),function t(){if(!n)for(var e=function(){clearTimeout(n),n=null,t()};0!==r.length;){var i=r[0];switch(r=r.splice(1),i.type){case"stall":return void(n=setTimeout(e,5));case"keydown":0!==r.length&&"keypress"===r[0].type&&(!r[0].escape||i.keysym&&i.keysym.keysym===r[0].keysym.keysym||(i.escape=r[0].escape),i.keysym=r[0].keysym,r=r.splice(1))}"stall"!==i.type&&s(i)}}()}}function TrackKeyState(c){"use strict";var l=[];return function(t){var e=0!==l.length?l[l.length-1]:null;switch(t.type){case"keydown":e&&t.keyId&&e.keyId===t.keyId||(e={keyId:t.keyId,keysyms:{}},l.push(e)),t.keysym&&(e.keysyms[t.keysym.keysym]=t.keysym,e.ignoreKeyPress=!0,c(t));break;case"keypress":e||(e={keyId:t.keyId,keysyms:{}},l.push(e)),t.keysym||console.log("keypress with no keysym:",t),t.keysym&&!e.ignoreKeyPress&&(e.keysyms[t.keysym.keysym]=t.keysym,t.type="keydown",c(t));break;case"keyup":if(0===l.length)return;for(var i=null,s=0;s!==l.length;++s)if(l[s].keyId===t.keyId){i=s;break}null===i&&(i=l.length-1);var r=l.splice(i,1)[0],n=function(t){return _.prototype=t,new _};for(a in r.keysyms){var o=n(t);o.keysym=r.keysyms[a],c(o)}break;case"releaseall":for(s=0;s<l.length;++s)for(var a in l[s].keysyms){var h=l[s].keysyms[a];c({keyId:0,keysym:h,type:"keyup"})}l=[]}function _(){}}}function EscapeModifiers(i){"use strict";return function(t){if("keydown"===t.type&&void 0!==t.escape){for(var e=0;e<t.escape.length;++e)i({type:"keyup",keyId:0,keysym:keysyms.lookup(t.escape[e])});i(t);for(e=0;e<t.escape.length;++e)i({type:"keydown",keyId:0,keysym:keysyms.lookup(t.escape[e])})}else i(t)}}!function(){"use strict";(Keyboard=function(t){this._keyDownList=[],Util.set_defaults(this,t,{target:document,focused:!0}),this._handler=new KeyEventDecoder(kbdUtil.ModifierSync(),VerifyCharModifier(TrackKeyState(EscapeModifiers(this._handleRfbEvent.bind(this))))),this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),keypress:this._handleKeyPress.bind(this),blur:this._allKeysUp.bind(this)}}).prototype={_handleRfbEvent:function(t){this._onKeyPress&&(Util.Debug("onKeyPress "+("keydown"==t.type?"down":"up")+", keysym: "+t.keysym.keysym+"("+t.keysym.keyname+")"),this._onKeyPress(t.keysym.keysym,"keydown"==t.type))},_handleKeyDown:function(t){return!this._focused||(!this._handler.keydown(t)||(Util.stopEvent(t),!1))},_handleKeyPress:function(t){return!this._focused||(!this._handler.keypress(t)||(Util.stopEvent(t),!1))},_handleKeyUp:function(t){return!this._focused||(!this._handler.keyup(t)||(Util.stopEvent(t),!1))},_allKeysUp:function(){Util.Debug(">> Keyboard.allKeysUp"),this._handler.releaseAll(),Util.Debug("<< Keyboard.allKeysUp")},grab:function(){var t=this._target;Util.addEvent(t,"keydown",this._eventHandlers.keydown),Util.addEvent(t,"keyup",this._eventHandlers.keyup),Util.addEvent(t,"keypress",this._eventHandlers.keypress),Util.addEvent(window,"blur",this._eventHandlers.blur)},ungrab:function(){var t=this._target;Util.removeEvent(t,"keydown",this._eventHandlers.keydown),Util.removeEvent(t,"keyup",this._eventHandlers.keyup),Util.removeEvent(t,"keypress",this._eventHandlers.keypress),Util.removeEvent(window,"blur",this._eventHandlers.blur),this._allKeysUp()},sync:function(t){this._handler.syncModifiers(t)}},Util.make_properties(Keyboard,[["target","wo","dom"],["focused","rw","bool"],["onKeyPress","rw","func"]]),(Mouse=function(t){this._mouseCaptured=!1,this._doubleClickTimer=null,this._lastTouchPos=null,Util.set_defaults(this,t,{target:document,focused:!0,scale:1,touchButton:1}),this._eventHandlers={mousedown:this._handleMouseDown.bind(this),mouseup:this._handleMouseUp.bind(this),mousemove:this._handleMouseMove.bind(this),mousewheel:this._handleMouseWheel.bind(this),mousedisable:this._handleMouseDisable.bind(this)}}).prototype={_captureMouse:function(){this._target.setCapture&&this._target.setCapture(),this._mouseCaptured=!0},_releaseMouse:function(){this._target.releaseCapture&&this._target.releaseCapture(),this._mouseCaptured=!1},_resetDoubleClickTimer:function(){this._doubleClickTimer=null},_handleMouseButton:function(t,e){if(!this._focused)return!0;this._notify&&this._notify(t);var i,s,r=t||window.event,n=Util.getEventPosition(t,this._target,this._scale),r=t.touches||t.changedTouches?(1==e&&(null===this._doubleClickTimer?this._lastTouchPos=n:(clearTimeout(this._doubleClickTimer),i=this._lastTouchPos.x-n.x,s=this._lastTouchPos.y-n.y,Math.sqrt(i*i+s*s)<20*(window.devicePixelRatio||1)&&(n=this._lastTouchPos)),this._doubleClickTimer=setTimeout(this._resetDoubleClickTimer.bind(this),500)),this._touchButton):r.which?1<<r.button:(1&r.button)+2*(2&r.button)+(4&r.button)/2;return this._onMouseButton&&(Util.Debug("onMouseButton "+(e?"down":"up")+", x: "+n.x+", y: "+n.y+", bmask: "+r),this._onMouseButton(n.x,n.y,e,r)),Util.stopEvent(t),!1},_handleMouseDown:function(t){this._captureMouse(),this._handleMouseButton(t,1)},_handleMouseUp:function(t){this._mouseCaptured&&(this._handleMouseButton(t,0),this._releaseMouse())},_handleMouseWheel:function(t){if(!this._focused)return!0;this._notify&&this._notify(t);var e=t||window.event,i=Util.getEventPosition(t,this._target,this._scale),e=0<(e.detail?-1*e.detail:e.wheelDelta/40)?8:16;return this._onMouseButton&&(this._onMouseButton(i.x,i.y,1,e),this._onMouseButton(i.x,i.y,0,e)),Util.stopEvent(t),!1},_handleMouseMove:function(t){if(!this._focused)return!0;this._notify&&this._notify(t);t||window.event;var e=Util.getEventPosition(t,this._target,this._scale);return this._onMouseMove&&this._onMouseMove(e.x,e.y),Util.stopEvent(t),!1},_handleMouseDisable:function(t){if(!this._focused)return!0;t||window.event;var e=Util.getEventPosition(t,this._target,this._scale);return!(0<=e.realx&&0<=e.realy&&e.realx<this._target.offsetWidth&&e.realy<this._target.offsetHeight)||(Util.stopEvent(t),!1)},grab:function(){var t=this._target;"ontouchstart"in document.documentElement&&(Util.addEvent(t,"touchstart",this._eventHandlers.mousedown),Util.addEvent(window,"touchend",this._eventHandlers.mouseup),Util.addEvent(t,"touchend",this._eventHandlers.mouseup),Util.addEvent(t,"touchmove",this._eventHandlers.mousemove)),Util.addEvent(t,"mousedown",this._eventHandlers.mousedown),Util.addEvent(window,"mouseup",this._eventHandlers.mouseup),Util.addEvent(t,"mouseup",this._eventHandlers.mouseup),Util.addEvent(t,"mousemove",this._eventHandlers.mousemove),Util.addEvent(t,Util.Engine.gecko?"DOMMouseScroll":"mousewheel",this._eventHandlers.mousewheel),Util.addEvent(document,"click",this._eventHandlers.mousedisable),Util.addEvent(document.body,"contextmenu",this._eventHandlers.mousedisable)},ungrab:function(){var t=this._target;"ontouchstart"in document.documentElement&&(Util.removeEvent(t,"touchstart",this._eventHandlers.mousedown),Util.removeEvent(window,"touchend",this._eventHandlers.mouseup),Util.removeEvent(t,"touchend",this._eventHandlers.mouseup),Util.removeEvent(t,"touchmove",this._eventHandlers.mousemove)),Util.removeEvent(t,"mousedown",this._eventHandlers.mousedown),Util.removeEvent(window,"mouseup",this._eventHandlers.mouseup),Util.removeEvent(t,"mouseup",this._eventHandlers.mouseup),Util.removeEvent(t,"mousemove",this._eventHandlers.mousemove),Util.removeEvent(t,Util.Engine.gecko?"DOMMouseScroll":"mousewheel",this._eventHandlers.mousewheel),Util.removeEvent(document,"click",this._eventHandlers.mousedisable),Util.removeEvent(document.body,"contextmenu",this._eventHandlers.mousedisable)}},Util.make_properties(Mouse,[["target","ro","dom"],["notify","ro","func"],["focused","rw","bool"],["scale","rw","float"],["onMouseButton","rw","func"],["onMouseMove","rw","func"],["touchButton","rw","int"]])}(),function(){"use strict";var _=!1;try{new ImageData(new Uint8ClampedArray(1),1,1),_=!0}catch(t){}(Display=function(t){if(this._drawCtx=null,this._c_forceCanvas=!1,this._renderQ=[],this._fb_width=0,this._fb_height=0,this._maxWidth=0,this._maxHeight=0,this._viewportLoc={x:0,y:0,w:0,h:0},this._cleanRect={x1:0,y1:0,x2:-1,y2:-1},this._prevDrawStyle="",this._tile=null,this._tile16x16=null,this._tile_x=0,this._tile_y=0,Util.set_defaults(this,t,{true_color:!0,colourMap:[],scale:1,viewport:!1,render_mode:""}),Util.Debug(">> Display.constructor"),!this._target)throw new Error("Target must be set");if("string"==typeof this._target)throw new Error("target must be a DOM element");if(!this._target.getContext)throw new Error("no getContext method");if(this._drawCtx||(this._drawCtx=this._target.getContext("2d")),Util.Debug("User Agent: "+navigator.userAgent),Util.Engine.gecko&&Util.Debug("Browser: gecko "+Util.Engine.gecko),Util.Engine.webkit&&Util.Debug("Browser: webkit "+Util.Engine.webkit),Util.Engine.trident&&Util.Debug("Browser: trident "+Util.Engine.trident),Util.Engine.presto&&Util.Debug("Browser: presto "+Util.Engine.presto),this.clear(),!("createImageData"in this._drawCtx))throw new Error("Canvas does not support createImageData");this._render_mode="canvas rendering",null===this._prefer_js&&(Util.Info("Prefering javascript operations"),this._prefer_js=!0),!this._cursor_uri&&null!==this._cursor_uri&&void 0!==this._cursor_uri||(this._cursor_uri=Util.browserSupportsCursorURIs()),Util.Debug("<< Display.constructor")}).prototype={viewportChangePos:function(t,e){var i=this._viewportLoc;t=Math.floor(t),e=Math.floor(e),this._viewport||(t=-i.w,e=-i.h);var s,r,n,o,a=i.x+i.w-1,h=i.y+i.h-1;a+(t=t<0&&i.x+t<0?-i.x:t)>=this._fb_width&&(t-=a+t-this._fb_width+1),h+(e=i.y+e<0?-i.y:e)>=this._fb_height&&(e-=h+e-this._fb_height+1),0===t&&0===e||(Util.Debug("viewportChange deltaX: "+t+", deltaY: "+e),i.x+=t,a+=t,i.y+=e,h+=e,o=this._cleanRect,i.x>o.x1&&(o.x1=i.x),a<o.x2&&(o.x2=a),i.y>o.y1&&(o.y1=i.y),h<o.y2&&(o.y2=h),n=t<0?(s=0,-t):(s=i.w-t,t),a=e<0?(r=0,-e):(r=i.h-e,e),o=this._drawCtx.fillStyle,h=this._target,this._drawCtx.fillStyle="rgb(255,255,255)",this._drawCtx.mozImageSmoothingEnabled?this._drawCtx.mozImageSmoothingEnabled=!1:this._drawCtx.webkitImageSmoothingEnabled?this._drawCtx.webkitImageSmoothingEnabled=!1:this._drawCtx.msImageSmoothingEnabled?this._drawCtx.msImageSmoothingEnabled=!1:this._drawCtx.imageSmoothingEnabled&&(this._drawCtx.imageSmoothingEnabled=!1),this._drawCtx.drawImage(h,0,0,i.w,i.h,-t,-e,i.w,i.h),0!==t&&this._drawCtx.fillRect(s,0,n,i.h),0!==e&&this._drawCtx.fillRect(0,r,i.w,a),this._drawCtx.fillStyle=o)},viewportChangeSize:function(t,e){void 0!==t&&void 0!==e||(Util.Debug("Setting viewport to full display region"),t=this._fb_width,e=this._fb_height);var i,s,r,n=this._viewportLoc;n.w===t&&n.h===e||(this._viewport&&(0!==this._maxWidth&&t>this._maxWidth&&(t=this._maxWidth),0!==this._maxHeight&&e>this._maxHeight&&(e=this._maxHeight)),s=this._cleanRect,t<n.w&&s.x2>n.x+t-1&&(s.x2=n.x+t-1),e<n.h&&s.y2>n.y+e-1&&(s.y2=n.y+e-1),n.w=t,n.h=e,(i=this._target).width===t&&i.height===e||(r=null,0<n.w&&0<n.h&&0<i.width&&0<i.height&&(s=i.width<n.w?i.width:n.w,n=i.height<n.h?i.height:n.h,r=this._drawCtx.getImageData(0,0,s,n)),i.width!==t&&(i.width=t,i.style.width=t+"px"),i.height!==e&&(i.height=e,i.style.height=e+"px"),r&&this._drawCtx.putImageData(r,0,0)))},getCleanDirtyReset:function(){var t,e,i=this._viewportLoc,s=this._cleanRect,r={x:s.x1,y:s.y1,w:s.x2-s.x1+1,h:s.y2-s.y1+1},n=[];return s.x1>=s.x2||s.y1>=s.y2?n.push({x:i.x,y:i.y,w:i.w,h:i.h}):(t=i.x+i.w-1,e=i.y+i.h-1,i.x<s.x1&&n.push({x:i.x,y:i.y,w:s.x1-i.x+1,h:i.h}),t>s.x2&&n.push({x:s.x2+1,y:i.y,w:t-s.x2,h:i.h}),i.y<s.y1&&n.push({x:s.x1,y:i.y,w:s.x2-s.x1+1,h:s.y1-i.y}),e>s.y2&&n.push({x:s.x1,y:s.y2+1,w:s.x2-s.x1+1,h:e-s.y2})),this._cleanRect={x1:i.x,y1:i.y,x2:i.x+i.w-1,y2:i.y+i.h-1},{cleanBox:r,dirtyBoxes:n}},absX:function(t){return t+this._viewportLoc.x},absY:function(t){return t+this._viewportLoc.y},resize:function(t,e){this._prevDrawStyle="",this._fb_width=t,this._fb_height=e,this._rescale(this._scale),this.viewportChangeSize()},clear:function(){this._logo?(this.resize(this._logo.width,this._logo.height),this.blitStringImage(this._logo.data,0,0)):(6===Util.Engine.trident&&this._drawCtx.clearRect(0,0,this._viewportLoc.w,this._viewportLoc.h),this.resize(240,20),this._drawCtx.clearRect(0,0,this._viewportLoc.w,this._viewportLoc.h)),this._renderQ=[]},fillRect:function(t,e,i,s,r,n){0===this._renderQ.length||n?(this._setFillColor(r),this._drawCtx.fillRect(t-this._viewportLoc.x,e-this._viewportLoc.y,i,s)):this.renderQ_push({type:"fill",x:t,y:e,width:i,height:s,color:r})},copyImage:function(t,e,i,s,r,n,o){var a,h,_;0===this._renderQ.length||o?(a=t-this._viewportLoc.x,h=e-this._viewportLoc.y,_=i-this._viewportLoc.x,o=s-this._viewportLoc.y,this._drawCtx.drawImage(this._target,a,h,r,n,_,o,r,n)):this.renderQ_push({type:"copy",old_x:t,old_y:e,x:i,y:s,width:r,height:n})},startTile:function(t,e,i,s,r){if(this._tile_x=t,this._tile_y=e,this._tile=16===i&&16===s?this._tile16x16:this._drawCtx.createImageData(i,s),this._prefer_js)for(var n=this._true_color?r:this._colourMap[r[0]],o=n[2],a=n[1],h=n[0],_=this._tile.data,c=0;c<i*s*4;c+=4)_[c]=o,_[c+1]=a,_[c+2]=h,_[c+3]=255;else this.fillRect(t,e,i,s,r,!0)},subTile:function(t,e,i,s,r){if(this._prefer_js)for(var n=this._true_color?r:this._colourMap[r[0]],o=n[2],a=n[1],h=n[0],_=t+i,c=e+s,l=this._tile.data,u=this._tile.width,f=e;f<c;f++)for(var d=t;d<_;d++){var p=4*(d+f*u);l[p]=o,l[1+p]=a,l[2+p]=h,l[3+p]=255}else this.fillRect(this._tile_x+t,this._tile_y+e,i,s,r,!0)},finishTile:function(){this._prefer_js&&this._drawCtx.putImageData(this._tile,this._tile_x-this._viewportLoc.x,this._tile_y-this._viewportLoc.y)},blitImage:function(t,e,i,s,r,n,o){0===this._renderQ.length||o?this._true_color?this._bgrxImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n):this._cmapImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n):((n=new Uint8Array(i*s*4)).set(new Uint8Array(r.buffer,0,n.length)),this.renderQ_push({type:"blit",data:n,x:t,y:e,width:i,height:s}))},blitRgbImage:function(t,e,i,s,r,n,o){0===this._renderQ.length||o?this._true_color?this._rgbImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n):this._cmapImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n):((n=new Uint8Array(i*s*4)).set(new Uint8Array(r.buffer,0,n.length)),this.renderQ_push({type:"blitRgb",data:n,x:t,y:e,width:i,height:s}))},blitRgbxImage:function(t,e,i,s,r,n,o){0===this._renderQ.length||o?this._rgbxImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n):((n=new Uint8Array(i*s*4)).set(new Uint8Array(r.buffer,0,n.length)),this.renderQ_push({type:"blitRgbx",data:n,x:t,y:e,width:i,height:s}))},blitStringImage:function(t,e,i){var s=new Image;return s.onload=function(){this._drawCtx.drawImage(s,e-this._viewportLoc.x,i-this._viewportLoc.y)}.bind(this),s.src=t,s},drawImage:function(t,e,i){this._drawCtx.drawImage(t,e-this._viewportLoc.x,i-this._viewportLoc.y)},renderQ_push:function(t){this._renderQ.push(t),1===this._renderQ.length&&this._scan_renderQ()},changeCursor:function(t,e,i,s,r,n){!1!==this._cursor_uri?this._true_color?Display.changeCursor(this._target,t,e,i,s,r,n):Display.changeCursor(this._target,t,e,i,s,r,n,this._colourMap):Util.Warn("changeCursor called but no cursor data URI support")},defaultCursor:function(){this._target.style.cursor="default"},disableLocalCursor:function(){this._target.style.cursor="none"},clippingDisplay:function(){var t=this._viewportLoc,e=this._fb_width>t.w||this._fb_height>t.h,i=0!==this._maxWidth&&0!==this._maxHeight,s=!1;return i&&(s=t.w>this._maxWidth||t.h>this._maxHeight),e||i&&s},get_context:function(){return this._drawCtx},set_scale:function(t){this._rescale(t)},set_width:function(t){this._fb_width=t},get_width:function(){return this._fb_width},set_height:function(t){this._fb_height=t},get_height:function(){return this._fb_height},autoscale:function(t,e,i){var s,r,n=t/e,o=this._fb_width/this._fb_height,a=n<=o?t/this._fb_width:e/this._fb_height;return 1<a&&i?(s=this._fb_width,r=this._fb_height,a=1):r=n<=o?(s=t,Math.round(t/o)):(s=Math.round(e*o),e),this._target.style.width=s+"px",this._target.style.height=r+"px",this._scale=a},_rescale:function(t){var e,i;this._scale=t,i=this._viewport&&0!==this._maxWidth&&0!==this._maxHeight?(e=Math.min(this._fb_width,this._maxWidth),Math.min(this._fb_height,this._maxHeight)):(e=this._fb_width,this._fb_height),this._target.style.width=Math.round(t*e)+"px",this._target.style.height=Math.round(t*i)+"px"},_setFillColor:function(t){t=this._true_color?t:this._colourMap[t],t="rgb("+t[2]+","+t[1]+","+t[0]+")";t!==this._prevDrawStyle&&(this._drawCtx.fillStyle=t,this._prevDrawStyle=t)},_rgbImageData:function(t,e,i,s,r,n,o,a){for(var h=this._drawCtx.createImageData(r,n),_=h.data,c=0,l=a;c<r*n*4;c+=4,l+=3)_[c]=o[l],_[c+1]=o[l+1],_[c+2]=o[l+2],_[c+3]=255;this._drawCtx.putImageData(h,t-i,e-s)},_bgrxImageData:function(t,e,i,s,r,n,o,a){for(var h=this._drawCtx.createImageData(r,n),_=h.data,c=0,l=a;c<r*n*4;c+=4,l+=4)_[c]=o[l+2],_[c+1]=o[l+1],_[c+2]=o[l],_[c+3]=255;this._drawCtx.putImageData(h,t-i,e-s)},_rgbxImageData:function(t,e,i,s,r,n,o,a){var h;_?h=new ImageData(new Uint8ClampedArray(o.buffer,o.byteOffset,r*n*4),r,n):(h=this._drawCtx.createImageData(r,n)).data.set(new Uint8ClampedArray(o.buffer,o.byteOffset,r*n*4)),this._drawCtx.putImageData(h,t-i,e-s)},_cmapImageData:function(t,e,i,s,r,n,o,a){for(var h=this._drawCtx.createImageData(r,n),_=h.data,c=this._colourMap,l=0,u=a;l<r*n*4;l+=4,u++){var f=c[o[u]];_[l]=f[2],_[l+1]=f[1],_[l+2]=f[0],_[l+3]=255}this._drawCtx.putImageData(h,t-i,e-s)},_scan_renderQ:function(){for(var t=!0;t&&0<this._renderQ.length;){var e=this._renderQ[0];switch(e.type){case"copy":this.copyImage(e.old_x,e.old_y,e.x,e.y,e.width,e.height,!0);break;case"fill":this.fillRect(e.x,e.y,e.width,e.height,e.color,!0);break;case"blit":this.blitImage(e.x,e.y,e.width,e.height,e.data,0,!0);break;case"blitRgb":this.blitRgbImage(e.x,e.y,e.width,e.height,e.data,0,!0);break;case"blitRgbx":this.blitRgbxImage(e.x,e.y,e.width,e.height,e.data,0,!0);break;case"img":e.img.complete?this.drawImage(e.img,e.x,e.y):t=!1}t&&this._renderQ.shift()}0<this._renderQ.length&&requestAnimFrame(this._scan_renderQ.bind(this))}},Util.make_properties(Display,[["target","wo","dom"],["context","ro","raw"],["logo","rw","raw"],["true_color","rw","bool"],["colourMap","rw","arr"],["scale","rw","float"],["viewport","rw","bool"],["width","rw","int"],["height","rw","int"],["maxWidth","rw","int"],["maxHeight","rw","int"],["render_mode","ro","str"],["prefer_js","rw","str"],["cursor_uri","rw","raw"]]),Display.changeCursor=function(t,e,i,s,r,n,o,a){var h=n,_=o;_<h?_=h:h=_;var c=[];c.push16le=function(t){this.push(255&t,t>>8&255)},c.push32le=function(t){this.push(255&t,t>>8&255,t>>16&255,t>>24&255)};var l,u,f,d,p,g=h*_*4,b=Math.ceil(h*_/8),y=Math.ceil(h*_/8);for(c.push16le(0),c.push16le(2),c.push16le(1),c.push(h),c.push(_),c.push(0),c.push(0),c.push16le(s),c.push16le(r),c.push32le(40+g+b+y),c.push32le(22),c.push32le(40),c.push32le(h),c.push32le(2*_),c.push16le(1),c.push16le(32),c.push32le(0),c.push32le(b+y),c.push32le(0),c.push32le(0),c.push32le(0),c.push32le(0),l=_-1;0<=l;l--)for(u=0;u<h;u++)n<=u||o<=l?(c.push(0),c.push(0),c.push(0),c.push(0)):(f=i[d=l*Math.ceil(n/8)+Math.floor(u/8)]<<u%8&128?255:0,a?(p=a[e[d=n*l+u]],c.push(p[2]),c.push(p[1]),c.push(p[0])):(c.push(e[(d=4*(n*l+u))+2]),c.push(e[d+1]),c.push(e[d])),c.push(f));for(l=0;l<_;l++)for(u=0;u<Math.ceil(h/8);u++)c.push(0);for(l=0;l<_;l++)for(u=0;u<Math.ceil(h/8);u++)c.push(0);y="data:image/x-icon;base64,"+Base64.encode(c);t.style.cursor="url("+y+")"+s+" "+r+", default"}}(),function(){"use strict";(RFB=function(t){t=t||{},this._rfb_host="",this._rfb_port=5900,this._rfb_password="",this._rfb_path="",this._rfb_state="disconnected",this._rfb_version=0,this._rfb_max_version=3.8,this._rfb_auth_scheme="",this._rfb_tightvnc=!1,this._rfb_xvp_ver=0,this._encodings=[["COPYRECT",1],["TIGHT",7],["TIGHT_PNG",-260],["HEXTILE",5],["RRE",2],["RAW",0],["DesktopSize",-223],["Cursor",-239],["JPEG_quality_med",-26],["compress_hi",-247],["last_rect",-224],["xvp",-309],["ExtendedDesktopSize",-308]],this._encHandlers={},this._encNames={},this._encStats={},this._sock=null,this._display=null,this._keyboard=null,this._mouse=null,this._sendTimer=null,this._disconnTimer=null,this._msgTimer=null,this._FBU={rects:0,subrects:0,lines:0,tiles:0,bytes:0,x:0,y:0,width:0,height:0,encoding:0,subencoding:-1,background:null,zlib:[]},this._fb_Bpp=4,this._fb_depth=3,this._fb_width=0,this._fb_height=0,this._fb_name="",this._destBuff=null,this._paletteBuff=new Uint8Array(1024),this._rre_chunk_sz=100,this._timing={last_fbu:0,fbu_total:0,fbu_total_cnt:0,full_fbu_total:0,full_fbu_cnt:0,fbu_rt_start:0,fbu_rt_total:0,fbu_rt_cnt:0,pixels:0},this._supportsSetDesktopSize=!1,this._screen_id=0,this._screen_flags=0,this._mouse_buttonMask=0,this._mouse_arr=[],this._viewportDragging=!1,this._viewportDragPos={},this._viewportHasMoved=!1,Util.set_defaults(this,t,{target:"null",focusContainer:document,encrypt:!1,true_color:!0,local_cursor:!1,shared:!0,view_only:!1,xvp_password_sep:"@",disconnectTimeout:3,wsProtocols:["binary"],repeaterID:"",viewportDrag:!1,onUpdateState:function(){},onPasswordRequired:function(){},onClipboard:function(){},onBell:function(){},onFBUReceive:function(){},onFBUComplete:function(){},onFBResize:function(){},onDesktopName:function(){},onXvpInit:function(){}}),Util.Debug(">> RFB.constructor"),Object.keys(RFB.encodingHandlers).forEach(function(t){this._encHandlers[t]=RFB.encodingHandlers[t].bind(this)}.bind(this));for(var e=0;e<this._encodings.length;e++)this._encHandlers[this._encodings[e][1]]=this._encHandlers[this._encodings[e][0]],this._encNames[this._encodings[e][1]]=this._encodings[e][0],this._encStats[this._encodings[e][1]]=[0,0];try{this._display=new Display({target:this._target})}catch(t){throw Util.Error("Display exception: "+t),t}this._keyboard=new Keyboard({target:this._focusContainer,onKeyPress:this._handleKeyPress.bind(this)}),this._mouse=new Mouse({target:this._target,onMouseButton:this._handleMouseButton.bind(this),onMouseMove:this._handleMouseMove.bind(this),notify:this._keyboard.sync.bind(this._keyboard)}),this._sock=new Websock,this._sock.on("message",this._handle_message.bind(this)),this._sock.on("open",function(){"connect"===this._rfb_state?this._updateState("ProtocolVersion","Starting VNC handshake"):this._fail("Got unexpected WebSocket connection")}.bind(this)),this._sock.on("close",function(t){Util.Warn("WebSocket on-close event");var e="";t.code&&(e=" (code: "+t.code,t.reason&&(e+=", reason: "+t.reason),e+=")"),"disconnect"===this._rfb_state?this._updateState("disconnected","VNC disconnected"+e):"ProtocolVersion"===this._rfb_state?this._fail("Failed to connect to server"+e):this._rfb_state in{failed:1,disconnected:1}?Util.Error("Received onclose while disconnected"+e):this._fail("Server disconnected"+e),this._sock.off("close")}.bind(this)),this._sock.on("error",function(t){Util.Warn("WebSocket on-error event")}),this._init_vars();t=this._display.get_render_mode();if(!Websock_native)throw this._cleanupSocket("fatal"),new Error("WebSocket support is required to use noVNC");Util.Info("Using native WebSockets"),this._updateState("loaded","noVNC ready: native WebSockets, "+t),Util.Debug("<< RFB.constructor")}).prototype={connect:function(t,e,i,s){if(this._rfb_host=t,this._rfb_port=e,this._rfb_password=void 0!==i?i:"",this._rfb_path=void 0!==s?s:"",!this._rfb_host||!this._rfb_port)return this._fail("Must set host and port");this._updateState("connect")},disconnect:function(){this._updateState("disconnect","Disconnecting"),this._sock.off("error"),this._sock.off("message"),this._sock.off("open")},sendPassword:function(t){this._rfb_password=t,this._rfb_state="Authentication",setTimeout(this._init_msg.bind(this),1)},sendCtrlAltDel:function(){if("normal"!==this._rfb_state||this._view_only)return!1;Util.Info("Sending Ctrl-Alt-Del"),RFB.messages.keyEvent(this._sock,XK_Control_L,1),RFB.messages.keyEvent(this._sock,XK_Alt_L,1),RFB.messages.keyEvent(this._sock,XK_Delete,1),RFB.messages.keyEvent(this._sock,XK_Delete,0),RFB.messages.keyEvent(this._sock,XK_Alt_L,0),RFB.messages.keyEvent(this._sock,XK_Control_L,0),this._sock.flush()},xvpOp:function(t,e){return!(this._rfb_xvp_ver<t)&&(Util.Info("Sending XVP operation "+e+" (version "+t+")"),this._sock.send_string("\0"+String.fromCharCode(t)+String.fromCharCode(e)),!0)},xvpShutdown:function(){return this.xvpOp(1,2)},xvpReboot:function(){return this.xvpOp(1,3)},xvpReset:function(){return this.xvpOp(1,4)},sendKey:function(t,e){if("normal"!==this._rfb_state||this._view_only)return!1;void 0!==e?(Util.Info("Sending key code ("+(e?"down":"up")+"): "+t),RFB.messages.keyEvent(this._sock,t,e?1:0)):(Util.Info("Sending key code (down + up): "+t),RFB.messages.keyEvent(this._sock,t,1),RFB.messages.keyEvent(this._sock,t,0)),this._sock.flush()},clipboardPasteFrom:function(t){"normal"===this._rfb_state&&(RFB.messages.clientCutText(this._sock,t),this._sock.flush())},requestDesktopSize:function(t,e){"normal"===this._rfb_state&&this._supportsSetDesktopSize&&(RFB.messages.setDesktopSize(this._sock,t,e,this._screen_id,this._screen_flags),this._sock.flush())},requestFrameBufferUpdate:function(){RFB.messages.fbUpdateRequests(this._sock,this._display.getCleanDirtyReset(),this._fb_width,this._fb_height)},_connect:function(){var t;Util.Debug(">> RFB.connect"),t="undefined"!=typeof UsingSocketIO?"http":this._encrypt?"wss":"ws",t+="://"+this._rfb_host+":"+this._rfb_port+"/"+this._rfb_path,Util.Info("connecting to "+t),this._sock.open(t,this._wsProtocols),Util.Debug("<< RFB.connect")},_init_vars:function(){var t;for(this._FBU.rects=0,this._FBU.subrects=0,this._FBU.lines=0,this._FBU.tiles=0,this._FBU.zlibs=[],this._mouse_buttonMask=0,this._mouse_arr=[],this._rfb_tightvnc=!1,t=0;t<this._encodings.length;t++)this._encStats[this._encodings[t][1]][0]=0;for(t=0;t<4;t++)this._FBU.zlibs[t]=new inflator.Inflate},_print_stats:function(){var t,e;for(Util.Info("Encoding stats for this connection:"),t=0;t<this._encodings.length;t++)0<(e=this._encStats[this._encodings[t][1]])[0]+e[1]&&Util.Info("    "+this._encodings[t][0]+": "+e[0]+" rects");for(Util.Info("Encoding stats since page load:"),t=0;t<this._encodings.length;t++)e=this._encStats[this._encodings[t][1]],Util.Info("    "+this._encodings[t][0]+": "+e[1]+" rects")},_cleanupSocket:function(t){this._sendTimer&&(clearInterval(this._sendTimer),this._sendTimer=null),this._msgTimer&&(clearInterval(this._msgTimer),this._msgTimer=null),this._display&&this._display.get_context()&&(this._keyboard.ungrab(),this._mouse.ungrab(),"connect"!==t&&"loaded"!==t&&this._display.defaultCursor(),"debug"===Util.get_logging()&&"loaded"!==t||this._display.clear()),this._sock.close()},_updateState:function(t,e){var i=this._rfb_state;t===i&&Util.Debug("Already in state '"+t+"', ignoring"),t in{disconnected:1,loaded:1,connect:1,disconnect:1,failed:1,fatal:1}&&this._cleanupSocket(t),"fatal"===i&&Util.Error("Fatal error, cannot continue");var s=void 0!==e?" Msg: "+e:"";switch("failed"===t||"fatal"===t?Util.Error(s):Util.Warn(s),this._rfb_state="failed"===i&&"disconnected"===t?"failed":t,this._disconnTimer&&"disconnect"!==this._rfb_state&&(Util.Debug("Clearing disconnect timer"),clearTimeout(this._disconnTimer),this._disconnTimer=null,this._sock.off("close")),t){case"normal":"disconnected"!==i&&"failed"!==i||Util.Error("Invalid transition from 'disconnected' or 'failed' to 'normal'");break;case"connect":this._init_vars(),this._connect();break;case"disconnect":this._disconnTimer=setTimeout(function(){this._fail("Disconnect timeout")}.bind(this),1e3*this._disconnectTimeout),this._print_stats();break;case"failed":"disconnected"===i?Util.Error("Invalid transition from 'disconnected' to 'failed'"):"normal"===i?Util.Error("Error while connected."):"init"===i&&Util.Error("Error while initializing."),setTimeout(function(){this._updateState("disconnected")}.bind(this),50)}"failed"===i&&"disconnected"===t?this._onUpdateState(this,t,i):this._onUpdateState(this,t,i,e)},_fail:function(t){return this._updateState("failed",t),!1},_handle_message:function(){if(0!==this._sock.rQlen())switch(this._rfb_state){case"disconnected":case"failed":Util.Error("Got data while disconnected");break;case"normal":this._normal_msg()&&0<this._sock.rQlen()&&(null===this._msgTimer?(Util.Debug("More data to process, creating timer"),this._msgTimer=setTimeout(function(){this._msgTimer=null,this._handle_message()}.bind(this),10)):Util.Debug("More data to process, existing timer"));break;default:this._init_msg()}else Util.Warn("handle_message called on an empty receive queue")},_handleKeyPress:function(t,e){this._view_only||(RFB.messages.keyEvent(this._sock,t,e),this._sock.flush())},_handleMouseButton:function(t,e,i,s){if(i?this._mouse_buttonMask|=s:this._mouse_buttonMask^=s,this._viewportDrag){if(i&&!this._viewportDragging)return this._viewportDragging=!0,void(this._viewportDragPos={x:t,y:e});this._viewportDragging=!1,this._viewportHasMoved||this._view_only||RFB.messages.pointerEvent(this._sock,this._display.absX(t),this._display.absY(e),s),this._viewportHasMoved=!1}this._view_only||"normal"===this._rfb_state&&RFB.messages.pointerEvent(this._sock,this._display.absX(t),this._display.absY(e),this._mouse_buttonMask)},_handleMouseMove:function(t,e){var i,s,r;this._viewportDragging?(i=this._viewportDragPos.x-t,s=this._viewportDragPos.y-e,r=10*(window.devicePixelRatio||1),(this._viewportHasMoved||Math.abs(i)>r||Math.abs(s)>r)&&(this._viewportHasMoved=!0,this._viewportDragPos={x:t,y:e},this._display.viewportChangePos(i,s),RFB.messages.fbUpdateRequests(this._sock,this._display.getCleanDirtyReset(),this._fb_width,this._fb_height))):this._view_only||"normal"===this._rfb_state&&RFB.messages.pointerEvent(this._sock,this._display.absX(t),this._display.absY(e),this._mouse_buttonMask)},_negotiate_protocol_version:function(){if(this._sock.rQlen()<12)return this._fail("Incomplete protocol version");var t=this._sock.rQshiftStr(12).substr(4,7);Util.Info("Server ProtocolVersion: "+t);var e=0;switch(t){case"000.000":e=1;break;case"003.003":case"003.006":case"003.889":this._rfb_version=3.3;break;case"003.007":this._rfb_version=3.7;break;case"003.008":case"004.000":case"004.001":this._rfb_version=3.8;break;default:return this._fail("Invalid server version "+t)}if(e){for(var i=this._repeaterID;i.length<250;)i+="\0";return this._sock.send_string(i),!0}this._rfb_version>this._rfb_max_version&&(this._rfb_version=this._rfb_max_version),this._sendTimer=setInterval(this._sock.flush.bind(this._sock),50);var s="00"+parseInt(this._rfb_version,10)+".00"+10*this._rfb_version%10;this._sock.send_string("RFB "+s+"\n"),this._updateState("Security","Sent ProtocolVersion: "+s)},_negotiate_security:function(){if(3.7<=this._rfb_version){var t=this._sock.rQshift8();if(this._sock.rQwait("security type",t,1))return!1;if(0===t){var e=this._sock.rQshift32(),e=this._sock.rQshiftStr(e);return this._fail("Security failure: "+e)}this._rfb_auth_scheme=0;var i=this._sock.rQshiftBytes(t);Util.Debug("Server security types: "+i);for(var s=0;s<i.length;s++)i[s]>this._rfb_auth_scheme&&(i[s]<=16||22==i[s])&&(this._rfb_auth_scheme=i[s]);if(0===this._rfb_auth_scheme)return this._fail("Unsupported security types: "+i);this._sock.send([this._rfb_auth_scheme])}else{if(this._sock.rQwait("security scheme",4))return!1;this._rfb_auth_scheme=this._sock.rQshift32()}return this._updateState("Authentication","Authenticating using scheme: "+this._rfb_auth_scheme),this._init_msg()},_negotiate_xvp_auth:function(){var t=this._xvp_password_sep,e=this._rfb_password.split(t);if(e.length<3)return this._updateState("password","XVP credentials required (user"+t+"target"+t+"password) -- got only "+this._rfb_password),this._onPasswordRequired(this),!1;var i=String.fromCharCode(e[0].length)+String.fromCharCode(e[1].length)+e[0]+e[1];return this._sock.send_string(i),this._rfb_password=e.slice(2).join(t),this._rfb_auth_scheme=2,this._negotiate_authentication()},_negotiate_std_vnc_auth:function(){if(0===this._rfb_password.length)return this._updateState("password","Password Required"),this._onPasswordRequired(this),!1;if(this._sock.rQwait("auth challenge",16))return!1;var t=Array.prototype.slice.call(this._sock.rQshiftBytes(16)),t=RFB.genDES(this._rfb_password,t);return this._sock.send(t),this._updateState("SecurityResult"),!0},_negotiate_tight_tunnels:function(t){for(var e={vendor:"TGHT",signature:"NOTUNNEL"},i={},s=0;s<t;s++){var r=this._sock.rQshift32(),n=this._sock.rQshiftStr(4),o=this._sock.rQshiftStr(8);i[r]={vendor:n,signature:o}}return i[0]?i[0].vendor!=e.vendor||i[0].signature!=e.signature?this._fail("Client's tunnel type had the incorrect vendor or signature"):(this._sock.send([0,0,0,0]),!1):this._fail("Server wanted tunnels, but doesn't support the notunnel type")},_negotiate_tight_auth:function(){if(!this._rfb_tightvnc){if(this._sock.rQwait("num tunnels",4))return!1;var t=this._sock.rQshift32();if(0<t&&this._sock.rQwait("tunnel capabilities",16*t,4))return!1;if(this._rfb_tightvnc=!0,0<t)return this._negotiate_tight_tunnels(t),!1}if(this._sock.rQwait("sub auth count",4))return!1;var e=this._sock.rQshift32();if(this._sock.rQwait("sub auth capabilities",16*e,4))return!1;for(var i,s={STDVNOAUTH__:1,STDVVNCAUTH_:2},r=[],n=0;n<e;n++){this._sock.rQshift32();var o=this._sock.rQshiftStr(12);r.push(o)}for(i in s)if(-1!=r.indexOf(i))switch(this._sock.send([0,0,0,s[i]]),i){case"STDVNOAUTH__":return this._updateState("SecurityResult"),!0;case"STDVVNCAUTH_":return this._rfb_auth_scheme=2,this._init_msg();default:return this._fail("Unsupported tiny auth scheme: "+i)}this._fail("No supported sub-auth types!")},_negotiate_authentication:function(){switch(this._rfb_auth_scheme){case 0:if(this._sock.rQwait("auth reason",4))return!1;var t=this._sock.rQshift32(),t=this._sock.rQshiftStr(t);return this._fail("Auth failure: "+t);case 1:return 3.8<=this._rfb_version?(this._updateState("SecurityResult"),!0):(this._updateState("ClientInitialisation","No auth required"),this._init_msg());case 22:return this._negotiate_xvp_auth();case 2:return this._negotiate_std_vnc_auth();case 16:return this._negotiate_tight_auth();default:return this._fail("Unsupported auth scheme: "+this._rfb_auth_scheme)}},_handle_security_result:function(){if(this._sock.rQwait("VNC auth response ",4))return!1;switch(this._sock.rQshift32()){case 0:return this._updateState("ClientInitialisation","Authentication OK"),this._init_msg();case 1:if(3.8<=this._rfb_version){var t=this._sock.rQshift32();if(this._sock.rQwait("SecurityResult reason",t,8))return!1;t=this._sock.rQshiftStr(t);return this._fail(t)}return this._fail("Authentication failure");case 2:return this._fail("Too many auth attempts")}},_negotiate_server_init:function(){if(this._sock.rQwait("server initialization",24))return!1;this._fb_width=this._sock.rQshift16(),this._fb_height=this._sock.rQshift16(),this._destBuff=new Uint8Array(this._fb_width*this._fb_height*4);var t=this._sock.rQshift8(),e=this._sock.rQshift8(),i=this._sock.rQshift8(),s=this._sock.rQshift8(),r=this._sock.rQshift16(),n=this._sock.rQshift16(),o=this._sock.rQshift16(),a=this._sock.rQshift8(),h=this._sock.rQshift8(),_=this._sock.rQshift8();this._sock.rQskipBytes(3);var c=this._sock.rQshift32();if(this._sock.rQwait("server init name",c,24))return!1;if(this._fb_name=Util.decodeUTF8(this._sock.rQshiftStr(c)),this._rfb_tightvnc){if(this._sock.rQwait("TightVNC extended server init header",8,24+c))return!1;var l=this._sock.rQshift16(),u=this._sock.rQshift16(),f=this._sock.rQshift16();if(this._sock.rQskipBytes(2),this._sock.rQwait("TightVNC extended server init header",16*(l+u+f),32+c))return!1;this._sock.rQskipBytes(16*l),this._sock.rQskipBytes(16*u),this._sock.rQskipBytes(16*f)}Util.Info("Screen: "+this._fb_width+"x"+this._fb_height+", bpp: "+t+", depth: "+e+", big_endian: "+i+", true_color: "+s+", red_max: "+r+", green_max: "+n+", blue_max: "+o+", red_shift: "+a+", green_shift: "+h+", blue_shift: "+_),0!==i&&Util.Warn("Server native endian is not little endian"),16!==a&&Util.Warn("Server native red-shift is not 16"),0!==_&&Util.Warn("Server native blue-shift is not 0"),this._onDesktopName(this,this._fb_name),this._true_color&&"Intel(r) AMT KVM"===this._fb_name&&(Util.Warn("Intel AMT KVM only supports 8/16 bit depths.  Disabling true color"),this._true_color=!1),this._display.set_true_color(this._true_color),this._display.resize(this._fb_width,this._fb_height),this._onFBResize(this,this._fb_width,this._fb_height),this._keyboard.grab(),this._mouse.grab(),this._true_color?(this._fb_Bpp=4,this._fb_depth=3):(this._fb_Bpp=1,this._fb_depth=1),RFB.messages.pixelFormat(this._sock,this._fb_Bpp,this._fb_depth,this._true_color),RFB.messages.clientEncodings(this._sock,this._encodings,this._local_cursor,this._true_color),RFB.messages.fbUpdateRequests(this._sock,this._display.getCleanDirtyReset(),this._fb_width,this._fb_height),this._timing.fbu_rt_start=(new Date).getTime(),this._timing.pixels=0,this._sock.flush(),this._encrypt?this._updateState("normal","Connected (encrypted) to: "+this._fb_name):this._updateState("normal","Connected (unencrypted) to: "+this._fb_name)},_init_msg:function(){switch(this._rfb_state){case"ProtocolVersion":return this._negotiate_protocol_version();case"Security":return this._negotiate_security();case"Authentication":return this._negotiate_authentication();case"SecurityResult":return this._handle_security_result();case"ClientInitialisation":return this._sock.send([this._shared?1:0]),this._updateState("ServerInitialisation","Authentication OK"),!0;case"ServerInitialisation":return this._negotiate_server_init()}},_handle_set_colour_map_msg:function(){Util.Debug("SetColorMapEntries"),this._sock.rQskip8();var t=this._sock.rQshift16(),e=this._sock.rQshift16();if(this._sock.rQwait("SetColorMapEntries",6*e,6))return!1;for(var i=0;i<e;i++){var s=parseInt(this._sock.rQshift16()/256,10),r=parseInt(this._sock.rQshift16()/256,10),n=parseInt(this._sock.rQshift16()/256,10);this._display.set_colourMap([n,r,s],t+i)}return Util.Debug("colourMap: "+this._display.get_colourMap()),Util.Info("Registered "+e+" colourMap entries"),!0},_handle_server_cut_text:function(){if(Util.Debug("ServerCutText"),this._sock.rQwait("ServerCutText header",7,1))return!1;this._sock.rQskipBytes(3);var t=this._sock.rQshift32();if(this._sock.rQwait("ServerCutText",t,8))return!1;t=this._sock.rQshiftStr(t);return this._onClipboard(this,t),!0},_handle_xvp_msg:function(){if(this._sock.rQwait("XVP version and message",3,1))return!1;this._sock.rQskip8();var t=this._sock.rQshift8(),e=this._sock.rQshift8();switch(e){case 0:this._updateState(this._rfb_state,"Operation Failed");break;case 1:this._rfb_xvp_ver=t,Util.Info("XVP extensions enabled (version "+this._rfb_xvp_ver+")"),this._onXvpInit(this._rfb_xvp_ver);break;default:this._fail("Disconnected: illegal server XVP message "+e)}return!0},_normal_msg:function(){var t=0<this._FBU.rects?0:this._sock.rQshift8();switch(t){case 0:var e=this._framebufferUpdate();return e&&(RFB.messages.fbUpdateRequests(this._sock,this._display.getCleanDirtyReset(),this._fb_width,this._fb_height),this._sock.flush()),e;case 1:return this._handle_set_colour_map_msg();case 2:return Util.Debug("Bell"),this._onBell(this),!0;case 3:return this._handle_server_cut_text();case 250:return this._handle_xvp_msg();default:return this._fail("Disconnected: illegal server message type "+t),Util.Debug("sock.rQslice(0, 30): "+this._sock.rQslice(0,30)),!0}},_framebufferUpdate:function(){var t,e=!0;if(0===this._FBU.rects){if(this._sock.rQwait("FBU header",3,1))return!1;this._sock.rQskip8(),this._FBU.rects=this._sock.rQshift16(),this._FBU.bytes=0,(this._timing.cur_fbu=0)<this._timing.fbu_rt_start&&(t=(new Date).getTime(),Util.Info("First FBU latency: "+(t-this._timing.fbu_rt_start)))}for(;0<this._FBU.rects;){if("normal"!==this._rfb_state)return!1;if(this._sock.rQwait("FBU",this._FBU.bytes))return!1;if(0===this._FBU.bytes){if(this._sock.rQwait("rect header",12))return!1;var i=this._sock.rQshiftBytes(12);if(this._FBU.x=(i[0]<<8)+i[1],this._FBU.y=(i[2]<<8)+i[3],this._FBU.width=(i[4]<<8)+i[5],this._FBU.height=(i[6]<<8)+i[7],this._FBU.encoding=parseInt((i[8]<<24)+(i[9]<<16)+(i[10]<<8)+i[11],10),this._onFBUReceive(this,{x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height,encoding:this._FBU.encoding,encodingName:this._encNames[this._FBU.encoding]}),!this._encNames[this._FBU.encoding])return this._fail("Disconnected: unsupported encoding "+this._FBU.encoding),!1}this._timing.last_fbu=(new Date).getTime();i=this._encHandlers[this._FBU.encoding];try{e=i()}catch(t){console.log("missed "+this._FBU.encoding+": "+i),e=this._encHandlers[this._FBU.encoding]()}if(t=(new Date).getTime(),this._timing.cur_fbu+=t-this._timing.last_fbu,e&&(this._encStats[this._FBU.encoding][0]++,this._encStats[this._FBU.encoding][1]++,this._timing.pixels+=this._FBU.width*this._FBU.height),this._timing.pixels>=this._fb_width*this._fb_height&&((this._FBU.width===this._fb_width&&this._FBU.height===this._fb_height||0<this._timing.fbu_rt_start)&&(this._timing.full_fbu_total+=this._timing.cur_fbu,this._timing.full_fbu_cnt++,Util.Info("Timing of full FBU, curr: "+this._timing.cur_fbu+", total: "+this._timing.full_fbu_total+", cnt: "+this._timing.full_fbu_cnt+", avg: "+this._timing.full_fbu_total/this._timing.full_fbu_cnt)),0<this._timing.fbu_rt_start&&(i=t-this._timing.fbu_rt_start,this._timing.fbu_rt_total+=i,this._timing.fbu_rt_cnt++,Util.Info("full FBU round-trip, cur: "+i+", total: "+this._timing.fbu_rt_total+", cnt: "+this._timing.fbu_rt_cnt+", avg: "+this._timing.fbu_rt_total/this._timing.fbu_rt_cnt),this._timing.fbu_rt_start=0)),!e)return e}return this._onFBUComplete(this,{x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height,encoding:this._FBU.encoding,encodingName:this._encNames[this._FBU.encoding]}),!0}},Util.make_properties(RFB,[["target","wo","dom"],["focusContainer","wo","dom"],["encrypt","rw","bool"],["true_color","rw","bool"],["local_cursor","rw","bool"],["shared","rw","bool"],["view_only","rw","bool"],["xvp_password_sep","rw","str"],["disconnectTimeout","rw","int"],["wsProtocols","rw","arr"],["repeaterID","rw","str"],["viewportDrag","rw","bool"],["onUpdateState","rw","func"],["onPasswordRequired","rw","func"],["onClipboard","rw","func"],["onBell","rw","func"],["onFBUReceive","rw","func"],["onFBUComplete","rw","func"],["onFBResize","rw","func"],["onDesktopName","rw","func"],["onXvpInit","rw","func"]]),RFB.prototype.set_local_cursor=function(t){!t||t in{0:1,no:1,false:1}?(this._local_cursor=!1,this._display.disableLocalCursor()):this._display.get_cursor_uri()?this._local_cursor=!0:(Util.Warn("Browser does not support local cursor"),this._display.disableLocalCursor())},RFB.prototype.get_display=function(){return this._display},RFB.prototype.get_keyboard=function(){return this._keyboard},RFB.prototype.get_mouse=function(){return this._mouse},RFB.messages={keyEvent:function(t,e,i){var s=t._sQ,r=t._sQlen;s[r]=4,s[r+1]=i,s[r+2]=0,s[r+3]=0,s[r+4]=e>>24,s[r+5]=e>>16,s[r+6]=e>>8,s[r+7]=e,t._sQlen+=8},pointerEvent:function(t,e,i,s){var r=t._sQ,n=t._sQlen;r[n]=5,r[n+1]=s,r[n+2]=e>>8,r[n+3]=e,r[n+4]=i>>8,r[n+5]=i,t._sQlen+=6},clientCutText:function(t,e){var i=t._sQ,s=t._sQlen;i[s]=6,i[s+1]=0,i[s+2]=0,i[s+3]=0;var r=e.length;i[s+4]=r>>24,i[s+5]=r>>16,i[s+6]=r>>8,i[s+7]=r;for(var n=0;n<r;n++)i[s+8+n]=e.charCodeAt(n);t._sQlen+=8+r},setDesktopSize:function(t,e,i,s,r){var n=t._sQ,o=t._sQlen;n[o]=251,n[o+1]=0,n[o+2]=e>>8,n[o+3]=e,n[o+4]=i>>8,n[o+5]=i,n[o+6]=1,n[o+7]=0,n[o+8]=s>>24,n[o+9]=s>>16,n[o+10]=s>>8,n[o+11]=s,n[o+12]=0,n[o+13]=0,n[o+14]=0,n[o+15]=0,n[o+16]=e>>8,n[o+17]=e,n[o+18]=i>>8,n[o+19]=i,n[o+20]=r>>24,n[o+21]=r>>16,n[o+22]=r>>8,n[o+23]=r,t._sQlen+=24},pixelFormat:function(t,e,i,s){var r=t._sQ,n=t._sQlen;r[n]=0,r[n+1]=0,r[n+2]=0,r[n+3]=0,r[n+4]=8*e,r[n+5]=8*i,r[n+6]=0,r[n+7]=s?1:0,r[n+8]=0,r[n+9]=255,r[n+10]=0,r[n+11]=255,r[n+12]=0,r[n+13]=255,r[n+14]=16,r[n+15]=8,r[n+16]=0,r[n+17]=0,r[n+18]=0,r[n+19]=0,t._sQlen+=20},clientEncodings:function(t,e,i,s){var r=t._sQ,n=t._sQlen;r[n]=2;for(var o,a=n+4,h=r[n+1]=0,_=0;_<e.length;_++)"Cursor"!==e[_][0]||i?"TIGHT"!==e[_][0]||s?(o=e[_][1],r[a]=o>>24,r[a+1]=o>>16,r[a+2]=o>>8,r[a+3]=o,a+=4,h++):Util.Warn("Skipping tight as it is only supported with true color"):Util.Debug("Skipping Cursor pseudo-encoding");r[n+2]=h>>8,r[n+3]=h,t._sQlen+=a-n},fbUpdateRequests:function(t,e,i,s){var r=e.cleanBox;0<r.w&&0<r.h&&(a=void 0===r.w?i:r.w,h=void 0===r.h?s:r.h,RFB.messages.fbUpdateRequest(t,1,r.x,r.y,a,h));for(var n=0;n<e.dirtyBoxes.length;n++){var o=e.dirtyBoxes[n],a=void 0===o.w?i:o.w,h=void 0===o.h?s:o.h;RFB.messages.fbUpdateRequest(t,0,o.x,o.y,a,h)}},fbUpdateRequest:function(t,e,i,s,r,n){var o=t._sQ,a=t._sQlen;void 0===i&&(i=0),void 0===s&&(s=0),o[a]=3,o[a+1]=e,o[a+2]=i>>8&255,o[a+3]=255&i,o[a+4]=s>>8&255,o[a+5]=255&s,o[a+6]=r>>8&255,o[a+7]=255&r,o[a+8]=n>>8&255,o[a+9]=255&n,t._sQlen+=10}},RFB.genDES=function(t,e){for(var i=[],s=0;s<t.length;s++)i.push(t.charCodeAt(s));return new DES(i).encrypt(e)},RFB.extract_data_uri=function(t){return";base64,"+Base64.encode(t)},RFB.encodingHandlers={RAW:function(){if(0===this._FBU.lines&&(this._FBU.lines=this._FBU.height),this._FBU.bytes=this._FBU.width*this._fb_Bpp,this._sock.rQwait("RAW",this._FBU.bytes))return!1;var t=this._FBU.y+(this._FBU.height-this._FBU.lines),e=Math.min(this._FBU.lines,Math.floor(this._sock.rQlen()/(this._FBU.width*this._fb_Bpp)));return this._display.blitImage(this._FBU.x,t,this._FBU.width,e,this._sock.get_rQ(),this._sock.get_rQi()),this._sock.rQskipBytes(this._FBU.width*e*this._fb_Bpp),this._FBU.lines-=e,0<this._FBU.lines?this._FBU.bytes=this._FBU.width*this._fb_Bpp:(this._FBU.rects--,this._FBU.bytes=0),!0},COPYRECT:function(){return this._FBU.bytes=4,!this._sock.rQwait("COPYRECT",4)&&(this._display.copyImage(this._sock.rQshift16(),this._sock.rQshift16(),this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height),this._FBU.rects--,!(this._FBU.bytes=0))},RRE:function(){var t;if(0===this._FBU.subrects){if(this._FBU.bytes=4+this._fb_Bpp,this._sock.rQwait("RRE",4+this._fb_Bpp))return!1;this._FBU.subrects=this._sock.rQshift32(),e=this._sock.rQshiftBytes(this._fb_Bpp),this._display.fillRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,e)}for(;0<this._FBU.subrects&&this._sock.rQlen()>=this._fb_Bpp+8;){var e=this._sock.rQshiftBytes(this._fb_Bpp),i=this._sock.rQshift16(),s=this._sock.rQshift16(),r=this._sock.rQshift16(),n=this._sock.rQshift16();this._display.fillRect(this._FBU.x+i,this._FBU.y+s,r,n,e),this._FBU.subrects--}return 0<this._FBU.subrects?(t=Math.min(this._rre_chunk_sz,this._FBU.subrects),this._FBU.bytes=(this._fb_Bpp+8)*t):(this._FBU.rects--,this._FBU.bytes=0),!0},HEXTILE:function(){var t=this._sock.get_rQ(),e=this._sock.get_rQi();for(0===this._FBU.tiles&&(this._FBU.tiles_x=Math.ceil(this._FBU.width/16),this._FBU.tiles_y=Math.ceil(this._FBU.height/16),this._FBU.total_tiles=this._FBU.tiles_x*this._FBU.tiles_y,this._FBU.tiles=this._FBU.total_tiles);0<this._FBU.tiles;){if(this._FBU.bytes=1,this._sock.rQwait("HEXTILE subencoding",this._FBU.bytes))return!1;var i=t[e];if(30<i)return this._fail("Disconnected: illegal hextile subencoding "+i),!1;var s=0,r=this._FBU.total_tiles-this._FBU.tiles,n=r%this._FBU.tiles_x,o=Math.floor(r/this._FBU.tiles_x),a=this._FBU.x+16*n,r=this._FBU.y+16*o,n=Math.min(16,this._FBU.x+this._FBU.width-a),o=Math.min(16,this._FBU.y+this._FBU.height-r);if(1&i)this._FBU.bytes+=n*o*this._fb_Bpp;else if(2&i&&(this._FBU.bytes+=this._fb_Bpp),4&i&&(this._FBU.bytes+=this._fb_Bpp),8&i){if(this._FBU.bytes++,this._sock.rQwait("hextile subrects header",this._FBU.bytes))return!1;s=t[e+this._FBU.bytes-1],this._FBU.bytes+=16&i?s*(this._fb_Bpp+2):2*s}if(this._sock.rQwait("hextile",this._FBU.bytes))return!1;if(this._FBU.subencoding=t[e],e++,0===this._FBU.subencoding)1&this._FBU.lastsubencoding?Util.Debug("     Ignoring blank after RAW"):this._display.fillRect(a,r,n,o,this._FBU.background);else if(1&this._FBU.subencoding)this._display.blitImage(a,r,n,o,t,e),e+=this._FBU.bytes-1;else{if(2&this._FBU.subencoding&&(1==this._fb_Bpp?this._FBU.background=t[e]:this._FBU.background=[t[e],t[e+1],t[e+2],t[e+3]],e+=this._fb_Bpp),4&this._FBU.subencoding&&(1==this._fb_Bpp?this._FBU.foreground=t[e]:this._FBU.foreground=[t[e],t[e+1],t[e+2],t[e+3]],e+=this._fb_Bpp),this._display.startTile(a,r,n,o,this._FBU.background),8&this._FBU.subencoding){s=t[e],e++;for(var h,_=0;_<s;_++){16&this._FBU.subencoding?(h=1===this._fb_Bpp?t[e]:[t[e],t[e+1],t[e+2],t[e+3]],e+=this._fb_Bpp):h=this._FBU.foreground;var c=t[e],l=t[++e];e++,this._display.subTile(c>>4,15&c,1+(l>>4),1+(15&l),h)}}this._display.finishTile()}this._sock.set_rQi(e),this._FBU.lastsubencoding=this._FBU.subencoding,this._FBU.bytes=0,this._FBU.tiles--}return 0===this._FBU.tiles&&this._FBU.rects--,!0},getTightCLength:function(t){var e=1,i=0;return i+=127&t[0],128&t[0]&&(e++,i+=(127&t[1])<<7,128&t[1]&&(e++,i+=t[2]<<14)),[e,i]},display_tight:function(t){if(1===this._fb_depth&&this._fail("Tight protocol handler only implements true color mode"),this._FBU.bytes=1,this._sock.rQwait("TIGHT compression-control",this._FBU.bytes))return!1;var n,o,s=0,r=-1,a=function(t,e){for(var i=0;i<4;i++)s>>i&1&&(this._FBU.zlibs[i].reset(),console.debug("RESET!"),Util.Info("Reset zlib stream "+i));return this._FBU.zlibs[r].inflate(t,!0,e)}.bind(this),h=function(t,e,i,s){for(var r=this._destBuff,n=Math.floor((i+7)/8),o=Math.floor(i/8),a=0;a<s;a++){for(var h,_,c,l=0;l<o;l++)for(h=7;0<=h;h--)c=3*(t[a*n+l]>>h&1),r[_=4*(a*i+8*l+7-h)]=e[c],r[_+1]=e[c+1],r[_+2]=e[c+2],r[_+3]=255;for(h=7;8-i%8<=h;h--)c=3*(t[a*n+l]>>h&1),r[_=4*(a*i+8*l+7-h)]=e[c],r[_+1]=e[c+1],r[_+2]=e[c+2],r[_+3]=255}return r}.bind(this),_=function(t,e,i,s){for(var r=this._destBuff,n=i*s*4,o=0,a=0;o<n;o+=4,a++){var h=3*t[a];r[o]=e[h],r[o+1]=e[1+h],r[o+2]=e[2+h],r[o+3]=255}return r}.bind(this),c=this._sock.get_rQi(),l=this._sock.rQwhole(),e=function(){var t=l[c+2]+1,e=t*this._fb_depth;if(this._FBU.bytes+=e,this._sock.rQwait("TIGHT palette "+n,this._FBU.bytes))return!1;var i,s=Math.floor((this._FBU.width*(t<=2?1:8)+7)/8),r=!1;return s*this._FBU.height<12?(r=!0,d=0,p=s*this._FBU.height):(d=1,p=0,p+=127&l[i=c+3+e],128&l[i]&&(d++,p+=(127&l[i+1])<<7,128&l[i+1]&&(d++,p+=l[i+2]<<14))),this._FBU.bytes+=d+p,!this._sock.rQwait("TIGHT "+n,this._FBU.bytes)&&(this._sock.rQskipBytes(3),this._sock.rQshiftTo(this._paletteBuff,e),this._sock.rQskipBytes(d),o=r?this._sock.rQshiftBytes(p):a(this._sock.rQshiftBytes(p),s*this._FBU.height),t=(2==t?h:_)(o,this._paletteBuff,this._FBU.width,this._FBU.height),this._display.blitRgbxImage(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,t,0,!1),!0)}.bind(this),i=function(){var t,e=!1,i=this._FBU.width*this._FBU.height*this._fb_depth;return i<12?(e=!0,d=0,p=i):(p=0,p+=127&l[t=c+(d=1)],128&l[t]&&(d++,p+=(127&l[t+1])<<7,128&l[t+1]&&(d++,p+=l[t+2]<<14))),this._FBU.bytes=1+d+p,!this._sock.rQwait("TIGHT "+n,this._FBU.bytes)&&(this._sock.rQshiftBytes(1+d),o=e?this._sock.rQshiftBytes(p):a(this._sock.rQshiftBytes(p),i),this._display.blitRgbImage(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,o,0,!1),!0)}.bind(this),u=this._sock.rQpeek8(),s=15&u,r=3&(u>>=4);if(8==u)n="fill";else if(9==u)n="jpeg";else if(10==u)n="png";else if(4&u)n="filter";else{if(!(u<4))return this._fail("Illegal tight compression received, ctl: "+u);n="copy"}if(t&&("filter"===n||"copy"===n))return this._fail("filter/copy received in tightPNG mode");switch(n){case"fill":this._FBU.bytes+=this._fb_depth;break;case"jpeg":case"png":this._FBU.bytes+=3;break;case"filter":this._FBU.bytes+=2}if(this._sock.rQwait("TIGHT "+n,this._FBU.bytes))return!1;switch(n){case"fill":this._display.fillRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,[l[c+3],l[c+2],l[c+1]],!1),this._sock.rQskipBytes(4);break;case"png":case"jpeg":var f=c+1,d=1,p=0;if(p+=127&l[f],128&l[f]&&(d++,p+=(127&l[f+1])<<7,128&l[f+1]&&(d++,p+=l[f+2]<<14)),this._FBU.bytes=1+d+p,this._sock.rQwait("TIGHT "+n,this._FBU.bytes))return!1;this._sock.rQskipBytes(1+d);f=new Image;f.src="data: image/"+n+RFB.extract_data_uri(this._sock.rQshiftBytes(p)),this._display.renderQ_push({type:"img",img:f,x:this._FBU.x,y:this._FBU.y}),f=null;break;case"filter":f=l[c+1];if(1===f){if(!e())return!1}else this._fail("Unsupported tight subencoding received, filter: "+f);break;case"copy":if(!i())return!1}return this._FBU.bytes=0,this._FBU.rects--,!0},TIGHT:function(){return this._encHandlers.display_tight(!1)},TIGHT_PNG:function(){return this._encHandlers.display_tight(!0)},last_rect:function(){return!(this._FBU.rects=0)},handle_FB_resize:function(){return this._fb_width=this._FBU.width,this._fb_height=this._FBU.height,this._destBuff=new Uint8Array(this._fb_width*this._fb_height*4),this._display.resize(this._fb_width,this._fb_height),this._onFBResize(this,this._fb_width,this._fb_height),this._timing.fbu_rt_start=(new Date).getTime(),this._FBU.bytes=0,--this._FBU.rects,!0},ExtendedDesktopSize:function(){if(this._FBU.bytes=1,this._sock.rQwait("ExtendedDesktopSize",this._FBU.bytes))return!1;this._supportsSetDesktopSize=!0;var t=this._sock.rQpeek8();if(this._FBU.bytes=4+16*t,this._sock.rQwait("ExtendedDesktopSize",this._FBU.bytes))return!1;this._sock.rQskipBytes(1),this._sock.rQskipBytes(3);for(var e=0;e<t;e+=1)0===e?(this._screen_id=this._sock.rQshiftBytes(4),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._screen_flags=this._sock.rQshiftBytes(4)):this._sock.rQskipBytes(16);if(1!==this._FBU.x||0===this._FBU.y)return this._encHandlers.handle_FB_resize(),!0;var i="";switch(this._FBU.y){case 1:i="Resize is administratively prohibited";break;case 2:i="Out of resources";break;case 3:i="Invalid screen layout";break;default:i="Unknown reason"}return Util.Info("Server did not accept the resize request: "+i),!0},DesktopSize:function(){return this._encHandlers.handle_FB_resize(),!0},Cursor:function(){Util.Debug(">> set_cursor");var t=this._FBU.x,e=this._FBU.y,i=this._FBU.width,s=this._FBU.height,r=i*s*this._fb_Bpp,n=Math.floor((i+7)/8)*s;return this._FBU.bytes=r+n,!this._sock.rQwait("cursor encoding",this._FBU.bytes)&&(this._display.changeCursor(this._sock.rQshiftBytes(r),this._sock.rQshiftBytes(n),t,e,i,s),this._FBU.bytes=0,this._FBU.rects--,Util.Debug("<< set_cursor"),!0)},JPEG_quality_lo:function(){Util.Error("Server sent jpeg_quality pseudo-encoding")},compress_lo:function(){Util.Error("Server sent compress level pseudo-encoding")}}}();var XK_VoidSymbol=16777215,XK_BackSpace=65288,XK_Tab=65289,XK_Linefeed=65290,XK_Clear=65291,XK_Return=65293,XK_Pause=65299,XK_Scroll_Lock=65300,XK_Sys_Req=65301,XK_Escape=65307,XK_Delete=65535,XK_Home=65360,XK_Left=65361,XK_Up=65362,XK_Right=65363,XK_Down=65364,XK_Prior=65365,XK_Page_Up=65365,XK_Next=65366,XK_Page_Down=65366,XK_End=65367,XK_Begin=65368,XK_Select=65376,XK_Print=65377,XK_Execute=65378,XK_Insert=65379,XK_Undo=65381,XK_Redo=65382,XK_Menu=65383,XK_Find=65384,XK_Cancel=65385,XK_Help=65386,XK_Break=65387,XK_Mode_switch=65406,XK_script_switch=65406,XK_Num_Lock=65407,XK_KP_Space=65408,XK_KP_Tab=65417,XK_KP_Enter=65421,XK_KP_F1=65425,XK_KP_F2=65426,XK_KP_F3=65427,XK_KP_F4=65428,XK_KP_Home=65429,XK_KP_Left=65430,XK_KP_Up=65431,XK_KP_Right=65432,XK_KP_Down=65433,XK_KP_Prior=65434,XK_KP_Page_Up=65434,XK_KP_Next=65435,XK_KP_Page_Down=65435,XK_KP_End=65436,XK_KP_Begin=65437,XK_KP_Insert=65438,XK_KP_Delete=65439,XK_KP_Equal=65469,XK_KP_Multiply=65450,XK_KP_Add=65451,XK_KP_Separator=65452,XK_KP_Subtract=65453,XK_KP_Decimal=65454,XK_KP_Divide=65455,XK_KP_0=65456,XK_KP_1=65457,XK_KP_2=65458,XK_KP_3=65459,XK_KP_4=65460,XK_KP_5=65461,XK_KP_6=65462,XK_KP_7=65463,XK_KP_8=65464,XK_KP_9=65465,XK_F1=65470,XK_F2=65471,XK_F3=65472,XK_F4=65473,XK_F5=65474,XK_F6=65475,XK_F7=65476,XK_F8=65477,XK_F9=65478,XK_F10=65479,XK_F11=65480,XK_L1=65480,XK_F12=65481,XK_L2=65481,XK_F13=65482,XK_L3=65482,XK_F14=65483,XK_L4=65483,XK_F15=65484,XK_L5=65484,XK_F16=65485,XK_L6=65485,XK_F17=65486,XK_L7=65486,XK_F18=65487,XK_L8=65487,XK_F19=65488,XK_L9=65488,XK_F20=65489,XK_L10=65489,XK_F21=65490,XK_R1=65490,XK_F22=65491,XK_R2=65491,XK_F23=65492,XK_R3=65492,XK_F24=65493,XK_R4=65493,XK_F25=65494,XK_R5=65494,XK_F26=65495,XK_R6=65495,XK_F27=65496,XK_R7=65496,XK_F28=65497,XK_R8=65497,XK_F29=65498,XK_R9=65498,XK_F30=65499,XK_R10=65499,XK_F31=65500,XK_R11=65500,XK_F32=65501,XK_R12=65501,XK_F33=65502,XK_R13=65502,XK_F34=65503,XK_R14=65503,XK_F35=65504,XK_R15=65504,XK_Shift_L=65505,XK_Shift_R=65506,XK_Control_L=65507,XK_Control_R=65508,XK_Caps_Lock=65509,XK_Shift_Lock=65510,XK_Meta_L=65511,XK_Meta_R=65512,XK_Alt_L=65513,XK_Alt_R=65514,XK_Super_L=65515,XK_Super_R=65516,XK_Hyper_L=65517,XK_Hyper_R=65518,XK_ISO_Level3_Shift=65027,XK_space=32,XK_exclam=33,XK_quotedbl=34,XK_numbersign=35,XK_dollar=36,XK_percent=37,XK_ampersand=38,XK_apostrophe=39,XK_quoteright=39,XK_parenleft=40,XK_parenright=41,XK_asterisk=42,XK_plus=43,XK_comma=44,XK_minus=45,XK_period=46,XK_slash=47,XK_0=48,XK_1=49,XK_2=50,XK_3=51,XK_4=52,XK_5=53,XK_6=54,XK_7=55,XK_8=56,XK_9=57,XK_colon=58,XK_semicolon=59,XK_less=60,XK_equal=61,XK_greater=62,XK_question=63,XK_at=64,XK_A=65,XK_B=66,XK_C=67,XK_D=68,XK_E=69,XK_F=70,XK_G=71,XK_H=72,XK_I=73,XK_J=74,XK_K=75,XK_L=76,XK_M=77,XK_N=78,XK_O=79,XK_P=80,XK_Q=81,XK_R=82,XK_S=83,XK_T=84,XK_U=85,XK_V=86,XK_W=87,XK_X=88,XK_Y=89,XK_Z=90,XK_bracketleft=91,XK_backslash=92,XK_bracketright=93,XK_asciicircum=94,XK_underscore=95,XK_grave=96,XK_quoteleft=96,XK_a=97,XK_b=98,XK_c=99,XK_d=100,XK_e=101,XK_f=102,XK_g=103,XK_h=104,XK_i=105,XK_j=106,XK_k=107,XK_l=108,XK_m=109,XK_n=110,XK_o=111,XK_p=112,XK_q=113,XK_r=114,XK_s=115,XK_t=116,XK_u=117,XK_v=118,XK_w=119,XK_x=120,XK_y=121,XK_z=122,XK_braceleft=123,XK_bar=124,XK_braceright=125,XK_asciitilde=126,XK_nobreakspace=160,XK_exclamdown=161,XK_cent=162,XK_sterling=163,XK_currency=164,XK_yen=165,XK_brokenbar=166,XK_section=167,XK_diaeresis=168,XK_copyright=169,XK_ordfeminine=170,XK_guillemotleft=171,XK_notsign=172,XK_hyphen=173,XK_registered=174,XK_macron=175,XK_degree=176,XK_plusminus=177,XK_twosuperior=178,XK_threesuperior=179,XK_acute=180,XK_mu=181,XK_paragraph=182,XK_periodcentered=183,XK_cedilla=184,XK_onesuperior=185,XK_masculine=186,XK_guillemotright=187,XK_onequarter=188,XK_onehalf=189,XK_threequarters=190,XK_questiondown=191,XK_Agrave=192,XK_Aacute=193,XK_Acircumflex=194,XK_Atilde=195,XK_Adiaeresis=196,XK_Aring=197,XK_AE=198,XK_Ccedilla=199,XK_Egrave=200,XK_Eacute=201,XK_Ecircumflex=202,XK_Ediaeresis=203,XK_Igrave=204,XK_Iacute=205,XK_Icircumflex=206,XK_Idiaeresis=207,XK_ETH=208,XK_Eth=208,XK_Ntilde=209,XK_Ograve=210,XK_Oacute=211,XK_Ocircumflex=212,XK_Otilde=213,XK_Odiaeresis=214,XK_multiply=215,XK_Oslash=216,XK_Ooblique=216,XK_Ugrave=217,XK_Uacute=218,XK_Ucircumflex=219,XK_Udiaeresis=220,XK_Yacute=221,XK_THORN=222,XK_Thorn=222,XK_ssharp=223,XK_agrave=224,XK_aacute=225,XK_acircumflex=226,XK_atilde=227,XK_adiaeresis=228,XK_aring=229,XK_ae=230,XK_ccedilla=231,XK_egrave=232,XK_eacute=233,XK_ecircumflex=234,XK_ediaeresis=235,XK_igrave=236,XK_iacute=237,XK_icircumflex=238,XK_idiaeresis=239,XK_eth=240,XK_ntilde=241,XK_ograve=242,XK_oacute=243,XK_ocircumflex=244,XK_otilde=245,XK_odiaeresis=246,XK_division=247,XK_oslash=248,XK_ooblique=248,XK_ugrave=249,XK_uacute=250,XK_ucircumflex=251,XK_udiaeresis=252,XK_yacute=253,XK_thorn=254,XK_ydiaeresis=255;!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).inflator=t()}(function(){return function s(r,n,o){function a(i,t){if(!n[i]){if(!r[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(h)return h(i,!0);e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}e=n[i]={exports:{}};r[i][0].call(e.exports,function(t){var e=r[i][1][t];return a(e||t)},e,e.exports,s,r,n,o)}return n[i].exports}for(var h="function"==typeof require&&require,t=0;t<o.length;t++)a(o[t]);return a}({1:[function(t,e,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,s,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+s),r);else for(var n=0;n<s;n++)t[r+n]=e[i+n]},flattenChunks:function(t){for(var e,i,s,r=0,n=0,o=t.length;n<o;n++)r+=t[n].length;for(s=new Uint8Array(r),n=e=0,o=t.length;n<o;n++)i=t[n],s.set(i,e),e+=i.length;return s}},n={arraySet:function(t,e,i,s,r){for(var n=0;n<s;n++)t[r+n]=e[i+n]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,n))},i.setTyped(s)},{}],2:[function(t,e,i){"use strict";e.exports=function(t,e,i,s){for(var r=65535&t|0,n=t>>>16&65535|0,o=0;0!==i;){for(i-=o=2e3<i?2e3:i;n=n+(r=r+e[s++]|0)|0,--o;);r%=65521,n%=65521}return r|n<<16|0}},{}],3:[function(t,e,i){"use strict";var a=function(){for(var t=[],e=0;e<256;e++){for(var i=e,s=0;s<8;s++)i=1&i?3988292384^i>>>1:i>>>1;t[e]=i}return t}();e.exports=function(t,e,i,s){var r=a,n=s+i;t^=-1;for(var o=s;o<n;o++)t=t>>>8^r[255&(t^e[o])];return-1^t}},{}],4:[function(t,e,i){"use strict";e.exports=function(t,e){var i,s,r,n,o,a,h=t.state,_=t.next_in,c=t.input,l=_+(t.avail_in-5),u=t.next_out,f=t.output,d=u-(e-t.avail_out),p=u+(t.avail_out-257),g=h.dmax,b=h.wsize,y=h.whave,m=h.wnext,w=h.window,v=h.hold,k=h.bits,U=h.lencode,K=h.distcode,X=(1<<h.lenbits)-1,B=(1<<h.distbits)-1;t:do{k<15&&(v+=c[_++]<<k,k+=8,v+=c[_++]<<k,k+=8),i=U[v&X];e:for(;;){if(v>>>=s=i>>>24,k-=s,0===(s=i>>>16&255))f[u++]=65535&i;else{if(!(16&s)){if(0==(64&s)){i=U[(65535&i)+(v&(1<<s)-1)];continue e}if(32&s){h.mode=12;break t}t.msg="invalid literal/length code",h.mode=30;break t}r=65535&i,(s&=15)&&(k<s&&(v+=c[_++]<<k,k+=8),r+=v&(1<<s)-1,v>>>=s,k-=s),k<15&&(v+=c[_++]<<k,k+=8,v+=c[_++]<<k,k+=8),i=K[v&B];i:for(;;){if(v>>>=s=i>>>24,k-=s,!(16&(s=i>>>16&255))){if(0==(64&s)){i=K[(65535&i)+(v&(1<<s)-1)];continue i}t.msg="invalid distance code",h.mode=30;break t}if(n=65535&i,k<(s&=15)&&(v+=c[_++]<<k,(k+=8)<s&&(v+=c[_++]<<k,k+=8)),g<(n+=v&(1<<s)-1)){t.msg="invalid distance too far back",h.mode=30;break t}if(v>>>=s,k-=s,(s=u-d)<n){if(y<(s=n-s)&&h.sane){t.msg="invalid distance too far back",h.mode=30;break t}if(a=w,(o=0)===m){if(o+=b-s,s<r){for(r-=s;f[u++]=w[o++],--s;);o=u-n,a=f}}else if(m<s){if(o+=b+m-s,(s-=m)<r){for(r-=s;f[u++]=w[o++],--s;);if(o=0,m<r){for(r-=s=m;f[u++]=w[o++],--s;);o=u-n,a=f}}}else if(o+=m-s,s<r){for(r-=s;f[u++]=w[o++],--s;);o=u-n,a=f}for(;2<r;)f[u++]=a[o++],f[u++]=a[o++],f[u++]=a[o++],r-=3;r&&(f[u++]=a[o++],1<r&&(f[u++]=a[o++]))}else{for(o=u-n;f[u++]=f[o++],f[u++]=f[o++],f[u++]=f[o++],2<(r-=3););r&&(f[u++]=f[o++],1<r&&(f[u++]=f[o++]))}break}}break}}while(_<l&&u<p);v&=(1<<(k-=(r=k>>3)<<3))-1,t.next_in=_-=r,t.next_out=u,t.avail_in=_<l?l-_+5:5-(_-l),t.avail_out=u<p?p-u+257:257-(u-p),h.hold=v,h.bits=k}},{}],5:[function(t,e,i){"use strict";var I=t("../utils/common"),D=t("./adler32"),R=t("./crc32"),M=t("./inffast"),T=t("./inftrees"),P=1,L=2,H=0,W=-2,z=1,s=852,r=592;function O(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new I.Buf16(320),this.work=new I.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=z,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new I.Buf32(s),e.distcode=e.distdyn=new I.Buf32(r),e.sane=1,e.back=-1,H):W}function a(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,o(t)):W}function h(t,e){var i,s;return t&&t.state?(s=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?W:(null!==s.window&&s.wbits!==e&&(s.window=null),s.wrap=i,s.wbits=e,a(t))):W}function _(t,e){var i;return t?(i=new n,(t.state=i).window=null,(e=h(t,e))!==H&&(t.state=null),e):W}var q,N,j=!0;i.inflateReset=a,i.inflateReset2=h,i.inflateResetKeep=o,i.inflateInit=function(t){return _(t,15)},i.inflateInit2=_,i.inflate=function(t,e){var i,s,r,n,o,a,h,_,c,l,u,f,d,p,g,b,y,m,w,v,k,U,K,X,B,x,F,Q,S,C=0,E=new I.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return W;12===(i=t.state).mode&&(i.mode=13),o=t.next_out,r=t.output,h=t.avail_out,n=t.next_in,s=t.input,a=t.avail_in,_=i.hold,c=i.bits,l=a,u=h,U=H;t:for(;;)switch(i.mode){case z:if(0===i.wrap){i.mode=13;break}for(;c<16;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if(2&i.wrap&&35615===_){E[i.check=0]=255&_,E[1]=_>>>8&255,i.check=R(i.check,E,2,0),c=_=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&_)<<8)+(_>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&_)){t.msg="unknown compression method",i.mode=30;break}if(c-=4,k=8+(15&(_>>>=4)),0===i.wbits)i.wbits=k;else if(k>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<k,t.adler=i.check=1,i.mode=512&_?10:12,c=_=0;break;case 2:for(;c<16;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if(i.flags=_,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=_>>8&1),512&i.flags&&(E[0]=255&_,E[1]=_>>>8&255,i.check=R(i.check,E,2,0)),c=_=0,i.mode=3;case 3:for(;c<32;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}i.head&&(i.head.time=_),512&i.flags&&(E[0]=255&_,E[1]=_>>>8&255,E[2]=_>>>16&255,E[3]=_>>>24&255,i.check=R(i.check,E,4,0)),c=_=0,i.mode=4;case 4:for(;c<16;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}i.head&&(i.head.xflags=255&_,i.head.os=_>>8),512&i.flags&&(E[0]=255&_,E[1]=_>>>8&255,i.check=R(i.check,E,2,0)),c=_=0,i.mode=5;case 5:if(1024&i.flags){for(;c<16;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}i.length=_,i.head&&(i.head.extra_len=_),512&i.flags&&(E[0]=255&_,E[1]=_>>>8&255,i.check=R(i.check,E,2,0)),c=_=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((f=a<(f=i.length)?a:f)&&(i.head&&(k=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),I.arraySet(i.head.extra,s,n,f,k)),512&i.flags&&(i.check=R(i.check,s,f,n)),a-=f,n+=f,i.length-=f),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===a)break t;for(f=0;k=s[n+f++],i.head&&k&&i.length<65536&&(i.head.name+=String.fromCharCode(k)),k&&f<a;);if(512&i.flags&&(i.check=R(i.check,s,f,n)),a-=f,n+=f,k)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===a)break t;for(f=0;k=s[n+f++],i.head&&k&&i.length<65536&&(i.head.comment+=String.fromCharCode(k)),k&&f<a;);if(512&i.flags&&(i.check=R(i.check,s,f,n)),a-=f,n+=f,k)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;c<16;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if(_!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}c=_=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;c<32;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}t.adler=i.check=O(_),c=_=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=o,t.avail_out=h,t.next_in=n,t.avail_in=a,i.hold=_,i.bits=c,2;t.adler=i.check=1,i.mode=12;case 12:if(5===e||6===e)break t;case 13:if(i.last){_>>>=7&c,c-=7&c,i.mode=27;break}for(;c<3;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}switch(i.last=1&_,--c,3&(_>>>=1)){case 0:i.mode=14;break;case 1:if(!function(t){if(j){var e;for(q=new I.Buf32(512),N=new I.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(T(P,t.lens,0,288,q,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;T(L,t.lens,0,32,N,0,t.work,{bits:5}),j=!1}t.lencode=q,t.lenbits=9,t.distcode=N,t.distbits=5}(i),i.mode=20,6!==e)break;_>>>=2,c-=2;break t;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}_>>>=2,c-=2;break;case 14:for(_>>>=7&c,c-=7&c;c<32;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if((65535&_)!=(_>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&_,c=_=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(f=i.length){if(0===(f=h<(f=a<f?a:f)?h:f))break t;I.arraySet(r,s,n,f,o),a-=f,n+=f,h-=f,o+=f,i.length-=f;break}i.mode=12;break;case 17:for(;c<14;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if(i.nlen=257+(31&_),_>>>=5,c-=5,i.ndist=1+(31&_),_>>>=5,c-=5,i.ncode=4+(15&_),_>>>=4,c-=4,286<i.nlen||30<i.ndist){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;c<3;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}i.lens[A[i.have++]]=7&_,_>>>=3,c-=3}for(;i.have<19;)i.lens[A[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,K={bits:i.lenbits},U=T(0,i.lens,0,19,i.lencode,0,i.work,K),i.lenbits=K.bits,U){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;b=(C=i.lencode[_&(1<<i.lenbits)-1])>>>16&255,y=65535&C,!((g=C>>>24)<=c);){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if(y<16)_>>>=g,c-=g,i.lens[i.have++]=y;else{if(16===y){for(X=g+2;c<X;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if(_>>>=g,c-=g,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}k=i.lens[i.have-1],f=3+(3&_),_>>>=2,c-=2}else if(17===y){for(X=g+3;c<X;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}c-=g,k=0,f=3+(7&(_>>>=g)),_>>>=3,c-=3}else{for(X=g+7;c<X;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}c-=g,k=0,f=11+(127&(_>>>=g)),_>>>=7,c-=7}if(i.have+f>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;f--;)i.lens[i.have++]=k}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,K={bits:i.lenbits},U=T(P,i.lens,0,i.nlen,i.lencode,0,i.work,K),i.lenbits=K.bits,U){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,K={bits:i.distbits},U=T(L,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,K),i.distbits=K.bits,U){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(6<=a&&258<=h){t.next_out=o,t.avail_out=h,t.next_in=n,t.avail_in=a,i.hold=_,i.bits=c,M(t,u),o=t.next_out,r=t.output,h=t.avail_out,n=t.next_in,s=t.input,a=t.avail_in,_=i.hold,c=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;b=(C=i.lencode[_&(1<<i.lenbits)-1])>>>16&255,y=65535&C,!((g=C>>>24)<=c);){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if(b&&0==(240&b)){for(m=g,w=b,v=y;b=(C=i.lencode[v+((_&(1<<m+w)-1)>>m)])>>>16&255,y=65535&C,!(m+(g=C>>>24)<=c);){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}_>>>=m,c-=m,i.back+=m}if(_>>>=g,c-=g,i.back+=g,i.length=y,0===b){i.mode=26;break}if(32&b){i.back=-1,i.mode=12;break}if(64&b){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&b,i.mode=22;case 22:if(i.extra){for(X=i.extra;c<X;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}i.length+=_&(1<<i.extra)-1,_>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;b=(C=i.distcode[_&(1<<i.distbits)-1])>>>16&255,y=65535&C,!((g=C>>>24)<=c);){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if(0==(240&b)){for(m=g,w=b,v=y;b=(C=i.distcode[v+((_&(1<<m+w)-1)>>m)])>>>16&255,y=65535&C,!(m+(g=C>>>24)<=c);){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}_>>>=m,c-=m,i.back+=m}if(_>>>=g,c-=g,i.back+=g,64&b){t.msg="invalid distance code",i.mode=30;break}i.offset=y,i.extra=15&b,i.mode=24;case 24:if(i.extra){for(X=i.extra;c<X;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}i.offset+=_&(1<<i.extra)-1,_>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===h)break t;if(i.offset>(f=u-h)){if((f=i.offset-f)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}d=f>i.wnext?(f-=i.wnext,i.wsize-f):i.wnext-f,f>i.length&&(f=i.length),p=i.window}else p=r,d=o-i.offset,f=i.length;for(h-=f=h<f?h:f,i.length-=f;r[o++]=p[d++],--f;);0===i.length&&(i.mode=21);break;case 26:if(0===h)break t;r[o++]=i.length,h--,i.mode=21;break;case 27:if(i.wrap){for(;c<32;){if(0===a)break t;a--,_|=s[n++]<<c,c+=8}if(u-=h,t.total_out+=u,i.total+=u,u&&(t.adler=i.check=(i.flags?R:D)(i.check,r,u,o-u)),u=h,(i.flags?_:O(_))!==i.check){t.msg="incorrect data check",i.mode=30;break}c=_=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;c<32;){if(0===a)break t;a--,_+=s[n++]<<c,c+=8}if(_!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}c=_=0}i.mode=29;case 29:U=1;break t;case 30:U=-3;break t;case 31:return-4;case 32:default:return W}return t.next_out=o,t.avail_out=h,t.next_in=n,t.avail_in=a,i.hold=_,i.bits=c,(i.wsize||u!==t.avail_out&&i.mode<30&&(i.mode<27||4!==e))&&(x=(B=t).output,F=t.next_out,Q=u-t.avail_out,null===(S=B.state).window&&(S.wsize=1<<S.wbits,S.wnext=0,S.whave=0,S.window=new I.Buf8(S.wsize)),Q>=S.wsize?(I.arraySet(S.window,x,F-S.wsize,S.wsize,0),S.wnext=0,S.whave=S.wsize):(B=S.wsize-S.wnext,I.arraySet(S.window,x,F-Q,B=Q<B?Q:B,S.wnext),(Q-=B)?(I.arraySet(S.window,x,F-Q,Q,0),S.wnext=Q,S.whave=S.wsize):(S.wnext+=B,S.wnext===S.wsize&&(S.wnext=0),S.whave<S.wsize&&(S.whave+=B)))),l-=t.avail_in,u-=t.avail_out,t.total_in+=l,t.total_out+=u,i.total+=u,i.wrap&&u&&(t.adler=i.check=(i.flags?R:D)(i.check,r,u,t.next_out-u)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),U=(0==l&&0===u||4===e)&&U===H?-5:U},i.inflateEnd=function(t){if(!t||!t.state)return W;var e=t.state;return e.window&&(e.window=null),t.state=null,H},i.inflateGetHeader=function(t,e){return!t||!t.state||0==(2&(t=t.state).wrap)?W:((t.head=e).done=!1,H)},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":2,"./crc32":3,"./inffast":4,"./inftrees":6}],6:[function(t,e,i){"use strict";var I=t("../utils/common"),D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],R=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],T=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,s,r,n,o,a){for(var h,_,c,l,u,f,d,p,g,b=a.bits,y=0,m=0,w=0,v=0,k=0,U=0,K=0,X=0,B=0,x=0,F=null,Q=0,S=new I.Buf16(16),C=new I.Buf16(16),E=null,A=0,y=0;y<=15;y++)S[y]=0;for(m=0;m<s;m++)S[e[i+m]]++;for(k=b,v=15;1<=v&&0===S[v];v--);if(v<k&&(k=v),0===v)return r[n++]=20971520,r[n++]=20971520,a.bits=1,0;for(w=1;w<v&&0===S[w];w++);for(k<w&&(k=w),y=X=1;y<=15;y++)if(X<<=1,(X-=S[y])<0)return-1;if(0<X&&(0===t||1!==v))return-1;for(C[1]=0,y=1;y<15;y++)C[y+1]=C[y]+S[y];for(m=0;m<s;m++)0!==e[i+m]&&(o[C[e[i+m]]++]=m);if(f=0===t?(F=E=o,19):1===t?(F=D,Q-=257,E=R,A-=257,256):(F=M,E=T,-1),y=w,u=n,c=-1,l=(B=1<<(U=k))-1,1===t&&852<B||2===t&&592<B)return 1;for(K=m=x=0;;){for(g=o[m]<f?(p=0,o[m]):o[m]>f?(p=E[A+o[m]],F[Q+o[m]]):(p=96,0),h=1<<(d=y-K),w=_=1<<U;r[u+(x>>K)+(_-=h)]=d<<24|p<<16|g|0,0!==_;);for(h=1<<y-1;x&h;)h>>=1;if(0!==h?(x&=h-1,x+=h):x=0,m++,0==--S[y]){if(y===v)break;y=e[i+o[m]]}if(k<y&&(x&l)!==c){for(u+=w,X=1<<(U=y-(K=0===K?k:K));U+K<v&&!((X-=S[U+K])<=0);)U++,X<<=1;if(B+=1<<U,1===t&&852<B||2===t&&592<B)return 1;r[c=x&l]=k<<24|U<<16|u-n|0}}return 0!==x&&(r[u+x]=y-K<<24|64<<16|0),a.bits=k,0}},{"../utils/common":1}],7:[function(t,e,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],8:[function(t,e,i){var s=t("../node_modules/pako/lib/zlib/inflate.js"),r=t("../node_modules/pako/lib/zlib/zstream.js"),t=function(){this.strm=new r,this.chunkSize=102400,this.strm.output=new Uint8Array(this.chunkSize),this.windowBits=5,s.inflateInit(this.strm,this.windowBits)};t.prototype={inflate:function(t,e,i){return this.strm.input=t,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0,this.strm.next_out=0,i>this.chunkSize&&(this.chunkSize=i,this.strm.output=new Uint8Array(this.chunkSize)),this.strm.avail_out=this.chunkSize,s.inflate(this.strm,e),new Uint8Array(this.strm.output.buffer,0,this.strm.next_out)},reset:function(){s.inflateReset(this.strm)}},e.exports={Inflate:t}},{"../node_modules/pako/lib/zlib/inflate.js":5,"../node_modules/pako/lib/zlib/zstream.js":7}]},{},[8])(8)});
//# sourceMappingURL=/js/novnc-core.min.js.map
